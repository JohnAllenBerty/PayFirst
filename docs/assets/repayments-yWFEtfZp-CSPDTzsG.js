import{v as t,B as xs,t as hs,A as ps,N as js,u as gs,_ as fs,T as bs,G as vs,H as Ns,P as i,x as e,Z as r,j as o,z as c,I as j,R as g}from"./index-DnKD0KXe.js";import{a as ys}from"./useMeta-Do0ZXGYI-DbPzVoKD.js";import{o as u}from"./skeleton-mX7TdaWE-Cq_BwO7K.js";import{n as ks,m as Cs,p as k,f,x as re,w as ne,b as d,i as ws}from"./table-DQfnjL0Y-DmfacWdK.js";import{o as Ss}from"./search-B37cGDDG-qSBiOTEd.js";const Ls=()=>{const{title:Ke}=ys("/repayments","Repayments • PayFirst"),[C,b]=t.useState(1),[_,Ve]=t.useState(10),[x,F]=t.useState("label"),[Je,ie]=t.useState(0),[R,Qe]=t.useState(""),[L,Xe]=t.useState(""),[m,de]=t.useState({}),{data:ce,isLoading:Ye}=xs({page_size:1e3}),{data:oe,isLoading:es}=hs({page_size:1e3}),[me,{isLoading:w}]=ps(),{data:ue,isLoading:ss}=js({page_size:1e3}),[as,{isLoading:ts}]=gs(),h=t.useMemo(()=>{const s=ce;if(!s)return[];if(s.status===!0){const l=s.data;if(Array.isArray(l))return l;const n=l;return Array.isArray(n.results)?n.results:[]}if(s.status===!1)return[];const a=s;return Array.isArray(a.results)?a.results:[]},[ce]),v=t.useMemo(()=>{const s=oe;if(!s)return[];if(s.status===!0){const l=s.data;if(Array.isArray(l))return l;const n=l;return Array.isArray(n.results)?n.results:[]}if(s.status===!1)return[];const a=s;return Array.isArray(a.results)?a.results:[]},[oe]),P=t.useMemo(()=>{const s=ue;if(!s)return[];if(s.status===!1)return[];if(s.status===!0){const l=s.data;if(Array.isArray(l))return l;const n=l;return Array.isArray(n.results)?n.results:[]}const a=s;return Array.isArray(a.results)?a.results:[]},[ue]),ls=t.useMemo(()=>{const s=[];if(m.label&&s.push(m.label),typeof m.transaction=="number"){const a=h.find(l=>l.id===m.transaction);a?.label&&s.push(a.label)}return s.join(" ").trim()||void 0},[m,h]),{data:S,isLoading:D,isFetching:rs}=fs({page:C,page_size:_,ordering:x,refresh:Je,search:ls}),[ns,{isLoading:is}]=bs(),[ds,{isLoading:cs}]=vs(),[os,{isLoading:xe}]=Ns(),he=t.useMemo(()=>{const s=S;if(!s)return{items:[],total:0};if(s.status===!0){const l=s.data;if(Array.isArray(l))return{items:l,total:l.length};const n=l;return Array.isArray(n.results)?{items:n.results,total:n.count??n.results.length}:{items:[],total:0}}if(s.status===!1)return{items:[],total:0};const a=s;return Array.isArray(a.results)?{items:a.results,total:a.count??a.results.length}:{items:[],total:0}},[S]),A=he.items,pe=he.total,je=t.useMemo(()=>{const s=S;return s&&s.status===!1?String(s.error??"Server error"):null},[S]),[M,ge]=t.useState(""),[T,fe]=t.useState(""),[be,ve]=t.useState(""),[Ne,ye]=t.useState(""),[ke,Ce]=t.useState(""),[$,q]=t.useState(""),[E,O]=t.useState(""),[we,Se]=t.useState(""),[I,W]=t.useState(!1),[U,Z]=t.useState(""),[B,G]=t.useState(!1),[Ae,H]=t.useState(!1),[ze,p]=t.useState(null),[ms,N]=t.useState(!1),[_e,K]=t.useState(null),[Fe,y]=t.useState(null),[Re,Le]=t.useState(""),[Pe,De]=t.useState(""),[Me,Te]=t.useState(""),[$e,qe]=t.useState(""),[Ee,Oe]=t.useState(""),[V,J]=t.useState(""),[Q,Ie]=t.useState(""),[We,Ue]=t.useState(""),[X,Y]=t.useState(!1),[ee,se]=t.useState(""),[ae,te]=t.useState(!1),[Ze,le]=t.useState(!1),Be=t.useRef("");t.useEffect(()=>{if(D||!(m.label||typeof m.transaction=="number"))return;const s=`${m.label||""}|${m.transaction||""}`;A.length===0&&Be.current!==s&&(Be.current=s,i.info("No repayments match your filters. Adjust or clear filters to see results."))},[D,A.length,m]);const[Ge,z]=t.useState(null),us=async s=>{if(s.preventDefault(),p(null),!M.trim())return p("Label is required"),!1;if(T==="")return p("Transaction is required"),!1;const a=parseFloat(be);if(!isFinite(a)||a<=0)return p("Amount must be > 0"),!1;try{const l=await ns({label:M.trim(),transaction:Number(T),amount:a,remarks:Ne.trim(),date:ke||new Date().toISOString().slice(0,10),payment_method:$===""?null:Number($),payment_source:E===""?null:Number(E),transaction_reference:we.trim()||null}).unwrap();return ge(""),fe(""),ve(""),ye(""),Ce(""),q(""),O(""),Se(""),i.success(j(l,"Repayment created")),ie(n=>n+1),!0}catch(l){const n=g(l);return p(n),i.error(n),!1}},He=A;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:Ke.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Record repayments against transactions."})]}),je&&e.jsxs("div",{className:"max-w-xl rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700 flex items-center justify-between gap-3",children:[e.jsx("span",{children:je}),e.jsx(r,{type:"button",size:"sm",variant:"outline",onClick:()=>ie(s=>s+1),children:"Retry"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{}),e.jsx(r,{size:"sm",onClick:()=>{N(!0),p(null)},children:"New Repayment"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"font-medium",children:"All repayments"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-muted-foreground",htmlFor:"rep-page-size",children:"Rows per page"}),e.jsxs("select",{id:"rep-page-size",className:"h-8 rounded-md border bg-background px-2 text-sm",value:_,onChange:s=>{Ve(Number(s.target.value)),b(1)},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(ks,{children:[e.jsxs(Cs,{children:[e.jsxs(k,{children:[e.jsx(f,{className:"cursor-pointer select-none","aria-label":"Sort by label",onClick:()=>F(s=>s==="label"?"-label":"label"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Label ",x.includes("label")&&(x.startsWith("-")?e.jsx(re,{className:"size-4"}):e.jsx(ne,{className:"size-4"}))]})}),e.jsx(f,{className:"cursor-pointer select-none","aria-label":"Sort by amount",onClick:()=>F(s=>s==="amount"?"-amount":"amount"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Amount ",x.includes("amount")&&(x.startsWith("-")?e.jsx(re,{className:"size-4"}):e.jsx(ne,{className:"size-4"}))]})}),e.jsx(f,{className:"cursor-pointer select-none","aria-label":"Sort by date",onClick:()=>F(s=>s==="date"?"-date":"date"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Date ",x.includes("date")&&(x.startsWith("-")?e.jsx(re,{className:"size-4"}):e.jsx(ne,{className:"size-4"}))]})}),e.jsx(f,{children:"Remarks"}),e.jsx(f,{children:"Transaction"}),e.jsx(f,{className:"w-[1%] whitespace-nowrap text-right pr-3",children:"Actions"})]}),e.jsxs(k,{children:[e.jsx(d,{children:e.jsxs("div",{className:"relative",children:[e.jsx(o,{value:R,onChange:s=>Qe(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),de({...m,label:R.trim()||void 0}),b(1))},placeholder:"Filter label…",className:"pl-8 h-8"}),e.jsx(Ss,{className:"absolute left-2 top-2 size-4 text-muted-foreground"})]})}),e.jsx(d,{}),e.jsx(d,{}),e.jsx(d,{}),e.jsx(d,{children:e.jsxs("select",{className:"h-8 rounded-md border bg-background px-2 text-sm",value:L,onChange:s=>Xe(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:"All transactions"}),h.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]})}),e.jsx(d,{className:"text-right pr-3",children:e.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2",disabled:rs,onClick:()=>{const s={},a=R.trim();a&&(s.label=a),typeof L=="number"&&(s.transaction=L),de(s),b(1)},children:"Apply"})})]})]}),e.jsx(ws,{children:D?Array.from({length:5}).map((s,a)=>e.jsxs(k,{children:[e.jsx(d,{children:e.jsx(u,{className:"h-4 w-40"})}),e.jsx(d,{children:e.jsx(u,{className:"h-4 w-24"})}),e.jsx(d,{children:e.jsx(u,{className:"h-4 w-24"})}),e.jsx(d,{children:e.jsx(u,{className:"h-4 w-32"})}),e.jsx(d,{children:e.jsx(u,{className:"h-4 w-40"})}),e.jsx(d,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(u,{className:"h-8 w-16"}),e.jsx(u,{className:"h-8 w-16"}),e.jsx(u,{className:"h-8 w-16"})]})})]},a)):He.length?He.map(s=>e.jsxs(k,{children:[e.jsx(d,{className:"font-medium",title:s.remarks?`${s.label} — ${s.remarks}`:s.label,children:s.label}),e.jsx(d,{children:s.amount}),e.jsx(d,{children:s.date}),e.jsx(d,{className:"text-muted-foreground",children:s.remarks||"—"}),e.jsx(d,{children:h.find(a=>a.id===s.transaction)?.label||s.transaction}),e.jsx(d,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(r,{size:"sm",variant:"outline",onClick:()=>K(s.id),children:"View"}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>{y(s.id),Le(s.label),De(s.transaction),Te(String(s.amount)),qe(s.remarks||""),Oe(s.date),J(typeof s.payment_method=="number"?s.payment_method:""),Ie(typeof s.payment_source=="number"?s.payment_source:""),Ue(s.transaction_reference||"")},children:"Edit"}),e.jsx(r,{size:"sm",variant:"destructive",onClick:()=>z(s.id),disabled:xe,children:"Delete"})]})})]},s.id)):e.jsx(k,{children:e.jsx(d,{colSpan:6,className:"text-sm text-muted-foreground",children:"No repayments found"})})})]})}),(()=>{const s=Math.max(1,Math.ceil(pe/_));return pe>0?e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx(r,{size:"sm",variant:"outline",onClick:()=>b(a=>Math.max(1,a-1)),disabled:C===1,children:"Prev"}),e.jsxs("span",{className:"text-xs",children:["Page ",C," of ",s]}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>b(a=>Math.min(s,a+1)),disabled:C>=s,children:"Next"})]}):null})()]}),ms&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>N(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"new-repayment-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"new-repayment-title",className:"font-semibold",children:"New repayment"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>N(!1),children:"Close"})]}),e.jsxs("form",{onSubmit:async s=>{await us(s)&&N(!1)},className:"grid gap-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"label",children:"Label"}),e.jsx(o,{id:"label",value:M,onChange:s=>ge(s.target.value),placeholder:"Repayment 1"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"transaction",children:"Transaction"}),e.jsxs("select",{id:"transaction",className:"h-9 rounded-md border bg-background px-3 text-sm",value:T,onChange:s=>fe(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",disabled:!0,children:Ye?"Loading…":"Select a transaction"}),h.map(s=>e.jsxs("option",{value:s.id,children:[s.label," (",s._type," ",s.amount,")"]},s.id))]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"amount",children:"Amount"}),e.jsx(o,{id:"amount",type:"number",min:"0",step:"0.01",value:be,onChange:s=>ve(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"remarks",children:"Remarks"}),e.jsx(o,{id:"remarks",value:Ne,onChange:s=>ye(s.target.value),placeholder:"Optional remarks"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"date",children:"Date"}),e.jsx(o,{id:"date",type:"date",value:ke,onChange:s=>Ce(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"payment-method",children:"Payment method (optional)"}),e.jsxs("select",{id:"payment-method",className:"h-9 rounded-md border bg-background px-3 text-sm",value:$,onChange:s=>q(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:es?"Loading…":"None"}),v.map(s=>e.jsxs("option",{value:s.id,children:[s.label,s.is_default?" (default)":""]},s.id))]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>W(s=>!s),children:I?"Cancel":"Add new"}),I&&w&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Saving…"})]}),I&&e.jsxs("div",{className:"mt-2 border rounded-md p-2 space-y-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(c,{htmlFor:"new-pm-label",className:"text-xs",children:"New method label"}),e.jsx(o,{id:"new-pm-label",value:U,onChange:s=>Z(s.target.value),placeholder:"e.g. Cash",className:"h-8"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:B,onChange:s=>G(s.target.checked)})," Default"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:Ae,onChange:s=>H(s.target.checked)})," Common"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(r,{type:"button",size:"sm",variant:"outline",className:"h-7 px-3",onClick:()=>{W(!1),Z(""),G(!1),H(!1)},children:"Cancel"}),e.jsx(r,{type:"button",size:"sm",className:"h-7 px-3",disabled:w,onClick:async()=>{if(!U.trim()){i.error("Label required");return}if(B&&v.some(s=>s.is_default)){i.error("Only one default method allowed");return}try{const s=await me({label:U.trim(),is_default:B,is_common:Ae}).unwrap();if(s?.status){const a=s.data;q(a.id),i.success(j(s,"Added"))}else i.success("Added");W(!1),Z(""),G(!1),H(!1)}catch(s){i.error(g(s))}},children:"Save"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"payment-source",children:"Payment source (optional)"}),e.jsxs("select",{id:"payment-source",className:"h-9 rounded-md border bg-background px-3 text-sm",value:E,onChange:s=>O(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:ss?"Loading…":"None"}),P.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:async()=>{const s=prompt("New payment source label?")?.trim();if(s)try{const a=await as({label:s}).unwrap();if(a?.status){const l=a.data;O(l.id),i.success(j(a,"Added"))}else i.success("Added")}catch(a){i.error(g(a))}},children:"Add new"}),ts&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Saving…"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"tx-ref",children:"Reference (optional)"}),e.jsx(o,{id:"tx-ref",value:we,onChange:s=>Se(s.target.value),placeholder:"e.g., UTR/Ref no."})]}),ze&&e.jsx("div",{className:"text-sm text-red-600",children:ze}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(r,{type:"submit",disabled:is,children:"Create"})]})]})]})}),_e!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>K(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"view-repayment-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"view-repayment-title",className:"font-semibold",children:"Repayment details"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>K(null),children:"Close"})]}),(()=>{const s=A.find(l=>l.id===_e);if(!s)return e.jsx("div",{className:"text-sm",children:"Not found"});const a=h.find(l=>l.id===s.transaction)?.label||s.transaction;return e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Label:"})," ",s.label]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Transaction:"})," ",String(a)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"})," ",s.amount]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Date:"})," ",s.date]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Remarks:"})," ",s.remarks||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment method:"})," ",v.find(l=>l.id===(s.payment_method??-1))?.label||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment source:"})," ",P.find(l=>l.id===(s.payment_source??-1))?.label||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Reference:"})," ",s.transaction_reference||"—"]})]})})()]})}),Fe!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>y(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"edit-repayment-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"edit-repayment-title",className:"font-semibold",children:"Edit repayment"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>y(null),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async s=>{s.preventDefault();try{const a=Fe,l=parseFloat(Me),n=await ds({id:a,changes:{label:Re.trim(),transaction:Pe,amount:l,remarks:$e.trim(),date:Ee,payment_method:V===""?null:Number(V),payment_source:Q===""?null:Number(Q),transaction_reference:We.trim()||null}}).unwrap();i.success(j(n,"Repayment updated")),y(null)}catch(a){const l=g(a);i.error(l)}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-label",children:"Label"}),e.jsx(o,{id:"edit-label",value:Re,onChange:s=>Le(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-payment-source",children:"Payment source (optional)"}),e.jsxs("select",{id:"edit-payment-source",className:"h-9 rounded-md border bg-background px-3 text-sm",value:Q,onChange:s=>Ie(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:"None"}),P.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-tx-ref",children:"Reference (optional)"}),e.jsx(o,{id:"edit-tx-ref",value:We,onChange:s=>Ue(s.target.value),placeholder:"e.g., UTR/Ref no."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-transaction",children:"Transaction"}),e.jsxs("select",{id:"edit-transaction",className:"h-9 rounded-md border bg-background px-3 text-sm",value:Pe,onChange:s=>De(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a transaction"}),h.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-amount",children:"Amount"}),e.jsx(o,{id:"edit-amount",type:"number",min:"0",step:"0.01",value:Me,onChange:s=>Te(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-remarks",children:"Remarks"}),e.jsx(o,{id:"edit-remarks",value:$e,onChange:s=>qe(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-date",children:"Date"}),e.jsx(o,{id:"edit-date",type:"date",value:Ee,onChange:s=>Oe(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-payment-method",children:"Payment method (optional)"}),e.jsxs("select",{id:"edit-payment-method",className:"h-9 rounded-md border bg-background px-3 text-sm",value:V,onChange:s=>J(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:"None"}),v.map(s=>e.jsxs("option",{value:s.id,children:[s.label,s.is_default?" (default)":""]},s.id))]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>Y(s=>!s),children:X?"Cancel":"Add new"}),X&&w&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Saving…"})]}),X&&e.jsxs("div",{className:"mt-2 border rounded-md p-2 space-y-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(c,{htmlFor:"new-pm-label-edit",className:"text-xs",children:"New method label"}),e.jsx(o,{id:"new-pm-label-edit",value:ee,onChange:s=>se(s.target.value),placeholder:"e.g. Cash",className:"h-8"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:ae,onChange:s=>te(s.target.checked)})," Default"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:Ze,onChange:s=>le(s.target.checked)})," Common"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(r,{type:"button",size:"sm",variant:"outline",className:"h-7 px-3",onClick:()=>{Y(!1),se(""),te(!1),le(!1)},children:"Cancel"}),e.jsx(r,{type:"button",size:"sm",className:"h-7 px-3",disabled:w,onClick:async()=>{if(!ee.trim()){i.error("Label required");return}if(ae&&v.some(s=>s.is_default)){i.error("Only one default method allowed");return}try{const s=await me({label:ee.trim(),is_default:ae,is_common:Ze}).unwrap();if(s?.status){const a=s.data;J(a.id),i.success(j(s,"Added"))}else i.success("Added");Y(!1),se(""),te(!1),le(!1)}catch(s){i.error(g(s))}},children:"Save"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>y(null),children:"Cancel"}),e.jsx(r,{type:"submit",disabled:cs,children:"Save"})]})]})]})}),Ge!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>z(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"delete-repayment-title",className:"bg-background rounded-md p-4 w-[420px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{id:"delete-repayment-title",className:"font-semibold mb-2",children:"Delete repayment"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(r,{variant:"outline",onClick:()=>z(null),children:"Cancel"}),e.jsx(r,{variant:"destructive",disabled:xe,onClick:async()=>{try{const s=await os(Ge).unwrap();i.success(j(s,"Repayment deleted"))}catch(s){const a=g(s);i.error(a)}finally{z(null)}},children:"Delete"})]})]})})]})};export{Ls as default};
