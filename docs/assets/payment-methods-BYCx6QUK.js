import{j as e}from"./vendor-radix-DPBOYssM.js";import{r as a}from"./vendor-redux-Waidrk23.js";import{v as ie,w as re,M as ne,N as de,y as r,B as i,I as S,j as M,k as P,L as U}from"./index-5kFlk6Lp.js";import{T as ce,b as oe,c as u,d as f,A as me,a as ue,e as l,f as he}from"./table-og8nlbqX.js";import{S as h}from"./skeleton-CXxmac8C.js";import{u as xe}from"./useMeta-KTTvbvi9.js";import{P as pe}from"./plus-Btw3L1RG.js";import"./vendor-react-gH-7aFTg.js";import"./vendor-router-Du5tOU4S.js";const Ce=()=>{const{title:B}=xe("/payment-methods","Payment Methods • PayFirst"),[x,d]=a.useState(1),[g,O]=a.useState(10),[b,Q]=a.useState("label"),[H,Y]=a.useState(0),[y,Z]=a.useState(""),[N,A]=a.useState({}),[$,q]=a.useState(""),{data:D,isLoading:L,isFetching:K}=ie({page:x,page_size:g,ordering:b,refresh:H,search:N.label}),[W,{isLoading:G}]=re(),[J,{isLoading:V}]=ne(),[X,{isLoading:ee}]=de(),z=a.useMemo(()=>{const s=D;if(!s)return{items:[],total:0};if(s.status===!0){const n=s.data;if(Array.isArray(n))return{items:n,total:n.length};const j=n;return Array.isArray(j.results)?{items:j.results,total:j.count??j.results.length}:{items:[],total:0}}if(s.status===!1)return{items:[],total:0};const t=s;return Array.isArray(t.results)?{items:t.results,total:t.count??t.results.length}:{items:[],total:0}},[D]),c=z.items,E=z.total,se=!!N.label;if(!L&&se&&c.length===0){const s=`${N.label||""}`;s!==$&&(q(s),r.info("No payment methods match your filter. Adjust or clear filters to see results."))}const[te,o]=a.useState(!1),[v,ae]=a.useState(""),[w,le]=a.useState(!1),[T,k]=a.useState(null),[F,m]=a.useState(null),[_,I]=a.useState(""),[C,R]=a.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:B.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage methods you use for transactions and repayments."})]}),e.jsxs(i,{size:"sm",onClick:()=>o(!0),children:[e.jsx(pe,{className:"mr-1 h-4 w-4"})," Add Method"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"font-medium",children:"All methods"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-muted-foreground",htmlFor:"pm-page-size",children:"Rows per page"}),e.jsxs("select",{id:"pm-page-size",className:"h-8 rounded-md border bg-background px-2 text-sm",value:g,onChange:s=>{O(Number(s.target.value)),d(1)},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(ce,{children:[e.jsxs(oe,{children:[e.jsxs(u,{children:[e.jsx(f,{className:"cursor-pointer select-none",onClick:()=>Q(s=>s==="label"?"-label":"label"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Label ",b.includes("label")&&(b.startsWith("-")?e.jsx(me,{className:"size-4"}):e.jsx(ue,{className:"size-4"}))]})}),e.jsx(f,{children:"Default"}),e.jsx(f,{children:"Common"}),e.jsx(f,{className:"w-[1%] whitespace-nowrap text-right pr-3",children:"Actions"})]}),e.jsxs(u,{children:[e.jsx(l,{children:e.jsx(S,{value:y,onChange:s=>Z(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),A({label:y.trim()||void 0}),d(1))},placeholder:"Filter label…",className:"h-8"})}),e.jsx(l,{}),e.jsx(l,{}),e.jsx(l,{className:"text-right pr-3",children:e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2",disabled:K,onClick:()=>{A({label:y.trim()||void 0}),d(1)},children:"Apply"})})]})]}),e.jsx(he,{children:L?Array.from({length:5}).map((s,t)=>e.jsxs(u,{children:[e.jsx(l,{children:e.jsx(h,{className:"h-4 w-40"})}),e.jsx(l,{children:e.jsx(h,{className:"h-4 w-16"})}),e.jsx(l,{children:e.jsx(h,{className:"h-4 w-16"})}),e.jsx(l,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(h,{className:"h-8 w-16"}),e.jsx(h,{className:"h-8 w-16"})]})})]},t)):c.length?c.map(s=>e.jsxs(u,{children:[e.jsx(l,{className:"font-medium",children:s.label}),e.jsx(l,{children:s.is_default?"Yes":"No"}),e.jsx(l,{children:s.is_common?"Yes":"No"}),e.jsx(l,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>{m(s.id),I(s.label),R(!!s.is_default)},children:"Edit"}),e.jsx(i,{size:"sm",variant:"destructive",disabled:ee,onClick:async()=>{try{const t=await X(s.id).unwrap();r.success(M(t,"Deleted"))}catch(t){r.error(P(t))}},children:"Delete"})]})})]},s.id)):e.jsx(u,{children:e.jsx(l,{colSpan:4,className:"text-sm text-muted-foreground",children:"No payment methods found"})})})]})}),(()=>{const s=Math.max(1,Math.ceil(E/g));return E>0?e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>d(t=>Math.max(1,t-1)),disabled:x===1,children:"Prev"}),e.jsxs("span",{className:"text-xs",children:["Page ",x," of ",s]}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>d(t=>Math.min(s,t+1)),disabled:x>=s,children:"Next"})]}):null})()]}),te&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>o(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"add-payment-method-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"add-payment-method-title",className:"font-semibold",children:"Add payment method"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>o(!1),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async s=>{if(s.preventDefault(),k(null),!v.trim()){k("Label is required");return}if(w&&c.some(t=>t.is_default)){k("There is already a default payment method. Unset it before creating a new default.");return}try{const t=await W({label:v.trim(),is_default:w}).unwrap();r.success(M(t,"Payment method added")),o(!1),Y(p=>p+1)}catch(t){r.error(P(t))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(U,{htmlFor:"pm-label",children:"Label"}),e.jsx(S,{id:"pm-label",value:v,onChange:s=>ae(s.target.value)})]}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:s=>le(s.target.checked)})," Default"]})}),T&&e.jsx("div",{className:"text-sm text-red-600",children:T}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(i,{type:"submit",disabled:G,children:"Add"})]})]})]})}),F!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>m(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"edit-payment-method-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"edit-payment-method-title",className:"font-semibold",children:"Edit payment method"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>m(null),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async s=>{s.preventDefault();try{const t=F;if(C&&c.some(n=>n.is_default&&n.id!==t)){r.error("Only one default method is allowed. Unset the other default first.");return}const p=await J({id:t,changes:{label:_.trim(),is_default:C}}).unwrap();r.success(M(p,"Updated")),m(null)}catch(t){r.error(P(t))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(U,{htmlFor:"edit-pm-label",children:"Label"}),e.jsx(S,{id:"edit-pm-label",value:_,onChange:s=>I(s.target.value)})]}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:s=>R(s.target.checked)})," Default"]})}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>m(null),children:"Cancel"}),e.jsx(i,{type:"submit",disabled:V,children:"Save"})]})]})]})})]})};export{Ce as default};
