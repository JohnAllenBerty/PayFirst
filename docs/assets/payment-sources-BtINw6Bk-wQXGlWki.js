import{v as a,N as ee,u as se,K as te,L as ae,P as i,x as e,Z as l,j as N,I as v,R as y,z as E}from"./index-DnKD0KXe.js";import{n as le,m as ie,p as m,f as R,x as re,w as ne,b as r,i as ce}from"./table-DQfnjL0Y-DmfacWdK.js";import{o as w}from"./skeleton-mX7TdaWE-Cq_BwO7K.js";import{a as de}from"./useMeta-Do0ZXGYI-DbPzVoKD.js";import{t as oe}from"./plus-CiLcYsv4-DazmbEJE.js";const pe=()=>{const{title:I}=de("/payment-sources","Payment Sources • PayFirst"),[u,c]=a.useState(1),[h,K]=a.useState(10),[j,U]=a.useState("label"),[Z,_]=a.useState(0),[p,q]=a.useState(""),[g,C]=a.useState({}),[T,W]=a.useState(""),{data:k,isLoading:S,isFetching:B}=ee({page:u,page_size:h,ordering:j,refresh:Z,search:g.label}),[G,{isLoading:H}]=se(),[J,{isLoading:O}]=te(),[Q,{isLoading:V}]=ae(),z=a.useMemo(()=>{const s=k;if(!s)return{items:[],total:0};if(s.status===!0){const n=s.data;if(Array.isArray(n))return{items:n,total:n.length};const x=n;return Array.isArray(x.results)?{items:x.results,total:x.count??x.results.length}:{items:[],total:0}}if(s.status===!1)return{items:[],total:0};const t=s;return Array.isArray(t.results)?{items:t.results,total:t.count??t.results.length}:{items:[],total:0}},[k]),b=z.items,A=z.total,X=!!g.label;if(!S&&X&&b.length===0){const s=`${g.label||""}`;s!==T&&(W(s),i.info("No payment sources match your filter. Adjust or clear filters to see results."))}const[Y,d]=a.useState(!1),[f,P]=a.useState(""),[L,$]=a.useState(null),[F,o]=a.useState(null),[D,M]=a.useState("");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:I.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track where payments come from (e.g., Bank A, UPI, etc.)."})]}),e.jsxs(l,{size:"sm",onClick:()=>d(!0),children:[e.jsx(oe,{className:"mr-1 h-4 w-4"})," Add Source"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"font-medium",children:"All sources"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-muted-foreground",htmlFor:"ps-page-size",children:"Rows per page"}),e.jsxs("select",{id:"ps-page-size",className:"h-8 rounded-md border bg-background px-2 text-sm",value:h,onChange:s=>{K(Number(s.target.value)),c(1)},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(le,{children:[e.jsxs(ie,{children:[e.jsxs(m,{children:[e.jsx(R,{className:"cursor-pointer select-none",onClick:()=>U(s=>s==="label"?"-label":"label"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Label ",j.includes("label")&&(j.startsWith("-")?e.jsx(re,{className:"size-4"}):e.jsx(ne,{className:"size-4"}))]})}),e.jsx(R,{className:"w-[1%] whitespace-nowrap text-right pr-3",children:"Actions"})]}),e.jsxs(m,{children:[e.jsx(r,{children:e.jsx(N,{value:p,onChange:s=>q(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),C({label:p.trim()||void 0}),c(1))},placeholder:"Filter label…",className:"h-8"})}),e.jsx(r,{className:"text-right pr-3",children:e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2",disabled:B,onClick:()=>{C({label:p.trim()||void 0}),c(1)},children:"Apply"})})]})]}),e.jsx(ce,{children:S?Array.from({length:5}).map((s,t)=>e.jsxs(m,{children:[e.jsx(r,{children:e.jsx(w,{className:"h-4 w-40"})}),e.jsx(r,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(w,{className:"h-8 w-16"}),e.jsx(w,{className:"h-8 w-16"})]})})]},t)):b.length?b.map(s=>e.jsxs(m,{children:[e.jsx(r,{className:"font-medium",children:s.label}),e.jsx(r,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{o(s.id),M(s.label)},children:"Edit"}),e.jsx(l,{size:"sm",variant:"destructive",disabled:V,onClick:async()=>{try{const t=await Q(s.id).unwrap();i.success(v(t,"Deleted"))}catch(t){i.error(y(t))}},children:"Delete"})]})})]},s.id)):e.jsx(m,{children:e.jsx(r,{colSpan:2,className:"text-sm text-muted-foreground",children:"No payment sources found"})})})]})}),(()=>{const s=Math.max(1,Math.ceil(A/h));return A>0?e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>c(t=>Math.max(1,t-1)),disabled:u===1,children:"Prev"}),e.jsxs("span",{className:"text-xs",children:["Page ",u," of ",s]}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>c(t=>Math.min(s,t+1)),disabled:u>=s,children:"Next"})]}):null})()]}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>d(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"add-payment-source-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"add-payment-source-title",className:"font-semibold",children:"Add payment source"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>d(!1),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async s=>{if(s.preventDefault(),$(null),!f.trim()){$("Label is required");return}try{const t=await G({label:f.trim()}).unwrap();i.success(v(t,"Payment source added")),P(""),d(!1),_(n=>n+1)}catch(t){i.error(y(t))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"ps-label",children:"Label"}),e.jsx(N,{id:"ps-label",value:f,onChange:s=>P(s.target.value)})]}),L&&e.jsx("div",{className:"text-sm text-red-600",children:L}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:H,children:"Add"})]})]})]})}),F!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>o(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"edit-payment-source-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"edit-payment-source-title",className:"font-semibold",children:"Edit payment source"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>o(null),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async s=>{s.preventDefault();try{const t=await J({id:F,changes:{label:D.trim()}}).unwrap();i.success(v(t,"Updated")),o(null)}catch(t){i.error(y(t))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"edit-ps-label",children:"Label"}),e.jsx(N,{id:"edit-ps-label",value:D,onChange:s=>M(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>o(null),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:O,children:"Save"})]})]})]})})]})};export{pe as default};
