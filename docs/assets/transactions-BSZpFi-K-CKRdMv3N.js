import{v as a,g as bs,t as fs,A as vs,N as Ns,u as ys,B as Cs,S as ws,E as ks,F as Ss,x as e,P as d,Z as i,j as o,z as c,I as z,R as b}from"./index-DnKD0KXe.js";import{a as _s}from"./useMeta-Do0ZXGYI-DbPzVoKD.js";import{o as m}from"./skeleton-mX7TdaWE-Cq_BwO7K.js";import{n as As,m as zs,p as w,f as x,x as F,w as L,b as r,i as Fs}from"./table-DQfnjL0Y-DmfacWdK.js";import{o as Ls}from"./search-B37cGDDG-qSBiOTEd.js";const Ms=()=>{const{title:Ye}=_s("/transactions","Transactions • PayFirst"),[h,f]=a.useState(1),[p,es]=a.useState(10),[u,k]=a.useState("label"),[oe,ue]=a.useState(0),[D,ss]=a.useState(""),[P,ts]=a.useState(""),[R,as]=a.useState(""),[l,me]=a.useState({}),{data:xe,isLoading:ns}=bs({page_size:1e3}),{data:he,isLoading:ls}=fs({page_size:1e3}),[pe,{isLoading:S}]=vs(),{data:je,isLoading:rs}=Ns({page_size:1e3}),[is,{isLoading:ds}]=ys(),v=a.useMemo(()=>{const s=he;if(!s)return[];if(s.status===!1)return[];if(s.status===!0){const n=s.data;return Array.isArray(n)?n:n.results??[]}const t=s;return Array.isArray(t.results)?t.results:[]},[he]),$=a.useMemo(()=>{const s=je;if(!s)return[];if(s.status===!1)return[];if(s.status===!0){const n=s.data;return Array.isArray(n)?n:n.results??[]}const t=s;return Array.isArray(t.results)?t.results:[]},[je]),j=a.useMemo(()=>{const s=xe;if(!s)return[];if(s.status===!1)return[];if(s.status===!0){const n=s.data;return Array.isArray(n)?n:n.results??[]}const t=s;return Array.isArray(t.results)?t.results:[]},[xe]),ge=a.useMemo(()=>{const s=[];if(l.label&&s.push(l.label),typeof l.contact=="number"){const t=j.find(n=>n.id===l.contact);t?.name&&s.push(t.name)}return s.join(" ").trim()||void 0},[l,j]),cs=a.useMemo(()=>{const s={ordering:u,refresh:oe,search:ge};return l._type||(s.page=h,s.page_size=p),s},[u,oe,ge,l._type,h,p]),{data:T,isLoading:M,isFetching:os}=Cs(cs),[us,{isLoading:ms}]=ws(),[xs,{isLoading:hs}]=ks(),[ps,{isLoading:be}]=Ss(),E=a.useMemo(()=>{const s=T;if(!s)return{items:[],total:0};if(s.status===!1)return{items:[],total:0};if(s.status===!0){const n=s.data;return Array.isArray(n)?{items:n,total:n.length}:{items:n.results??[],total:n.count??(n.results?n.results.length:0)}}const t=s;return Array.isArray(t.results)?{items:t.results,total:t.count}:{items:[],total:0}},[T]),q=a.useMemo(()=>{let s=E.items;return l._type&&(s=s.filter(t=>t._type===l._type)),typeof l.contact=="number"&&(s=s.filter(t=>t.contact===l.contact)),l.label&&(s=s.filter(t=>t.label.toLowerCase().includes(l.label.toLowerCase()))),s},[E.items,l]),fe=l._type?q.length:E.total,ve=(()=>{const s=T;return s&&s.status===!1?String(s.error??"Server error"):null})(),[O,Ne]=a.useState(""),[W,ye]=a.useState(""),[Ce,we]=a.useState("credit"),[ke,Se]=a.useState(""),[_e,Ae]=a.useState(""),[ze,Fe]=a.useState(""),[Le,g]=a.useState(null),[js,N]=a.useState(!1),[I,U]=a.useState(""),[Z,B]=a.useState(""),[De,Pe]=a.useState(""),[J,K]=a.useState(!1),[V,G]=a.useState(""),[H,Q]=a.useState(!1),[Re,X]=a.useState(!1),y=q,[$e,Y]=a.useState(null),[Te,C]=a.useState(null),[Me,Ee]=a.useState(""),[qe,Oe]=a.useState("credit"),[We,Ie]=a.useState(""),[Ue,Ze]=a.useState(""),[Be,Je]=a.useState(""),[Ke,_]=a.useState(null),gs=async s=>{if(s.preventDefault(),g(null),!O.trim())return g("Label is required"),!1;if(W==="")return g("Contact is required"),!1;const t=parseFloat(ke);if(!isFinite(t)||t<=0)return g("Amount must be > 0"),!1;try{const n=await us({label:O.trim(),contact:Number(W),_type:Ce,amount:t,description:_e.trim(),return_date:ze||null,date:new Date().toISOString().slice(0,10),payment_method:I===""?null:Number(I),payment_source:Z===""?null:Number(Z),transaction_reference:De.trim()||null}).unwrap();return Ne(""),ye(""),we("credit"),Se(""),Ae(""),Fe(""),U(""),B(""),Pe(""),d.success(z(n,"Transaction created")),ue(A=>A+1),!0}catch(n){const A=b(n);return g(A),d.error(A),!1}},[ee,se]=a.useState(""),[te,Ve]=a.useState(""),[Ge,He]=a.useState(""),[ae,ne]=a.useState(!1),[le,re]=a.useState(""),[ie,de]=a.useState(!1),[Qe,ce]=a.useState(!1),Xe=a.useRef("");return a.useEffect(()=>{if(M||!(l.label||l._type||typeof l.contact=="number"))return;const s=`${l.label||""}|${l._type||""}|${l.contact||""}`;y.length===0&&Xe.current!==s&&(Xe.current=s,d.info("No transactions match your filters. Adjust or clear filters to see results."))},[M,y.length,l]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:Ye.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Record credits and debits for your contacts."})]}),ve&&e.jsxs("div",{className:"max-w-xl rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700 flex items-center justify-between gap-3",children:[e.jsx("span",{children:ve}),e.jsx(i,{type:"button",size:"sm",variant:"outline",onClick:()=>ue(s=>s+1),children:"Retry"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{}),e.jsx(i,{size:"sm",onClick:()=>{N(!0),g(null)},children:"New Transaction"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"font-medium",children:"All transactions"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-muted-foreground",htmlFor:"tx-page-size",children:"Rows per page"}),e.jsxs("select",{id:"tx-page-size",className:"h-8 rounded-md border bg-background px-2 text-sm",value:p,onChange:s=>{es(Number(s.target.value)),f(1)},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(As,{children:[e.jsxs(zs,{children:[e.jsxs(w,{children:[e.jsx(x,{className:"cursor-pointer select-none","aria-label":"Sort by label",onClick:()=>k(s=>s==="label"?"-label":"label"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Label ",u.includes("label")&&(u.startsWith("-")?e.jsx(F,{className:"size-4"}):e.jsx(L,{className:"size-4"}))]})}),e.jsx(x,{children:"Type"}),e.jsx(x,{className:"cursor-pointer select-none","aria-label":"Sort by amount",onClick:()=>k(s=>s==="amount"?"-amount":"amount"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Amount ",u.includes("amount")&&(u.startsWith("-")?e.jsx(F,{className:"size-4"}):e.jsx(L,{className:"size-4"}))]})}),e.jsx(x,{children:"Pending"}),e.jsx(x,{children:"Contact"}),e.jsx(x,{className:"cursor-pointer select-none","aria-label":"Sort by date",onClick:()=>k(s=>s==="date"?"-date":"date"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Date ",u.includes("date")&&(u.startsWith("-")?e.jsx(F,{className:"size-4"}):e.jsx(L,{className:"size-4"}))]})}),e.jsx(x,{className:"cursor-pointer select-none","aria-label":"Sort by return date",onClick:()=>k(s=>s==="return_date"?"-return_date":"return_date"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Return date ",u.includes("return_date")&&(u.startsWith("-")?e.jsx(F,{className:"size-4"}):e.jsx(L,{className:"size-4"}))]})}),e.jsx(x,{className:"w-[1%] whitespace-nowrap text-right pr-3",children:"Actions"})]}),e.jsxs(w,{children:[e.jsx(r,{children:e.jsxs("div",{className:"relative",children:[e.jsx(o,{value:D,onChange:s=>ss(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),me({...l,label:D.trim()||void 0}),f(1))},placeholder:"Filter label…",className:"pl-8 h-8"}),e.jsx(Ls,{className:"absolute left-2 top-2 size-4 text-muted-foreground"})]})}),e.jsx(r,{children:e.jsxs("select",{className:"h-8 rounded-md border bg-background px-2 text-sm",value:P,onChange:s=>ts(s.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"credit",children:"Credit"}),e.jsx("option",{value:"debit",children:"Debit"})]})}),e.jsx(r,{}),e.jsx(r,{}),e.jsx(r,{children:e.jsxs("select",{className:"h-8 rounded-md border bg-background px-2 text-sm",value:R,onChange:s=>as(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:"All contacts"}),j.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsx(r,{}),e.jsx(r,{className:"text-right pr-3",children:e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2",disabled:os,onClick:()=>{const s={},t=D.trim();t&&(s.label=t),P&&(s._type=P),typeof R=="number"&&(s.contact=R),me(s),f(1)},children:"Apply"})})]})]}),e.jsx(Fs,{children:M?Array.from({length:5}).map((s,t)=>e.jsxs(w,{children:[e.jsx(r,{children:e.jsx(m,{className:"h-4 w-40"})}),e.jsx(r,{children:e.jsx(m,{className:"h-4 w-16"})}),e.jsx(r,{children:e.jsx(m,{className:"h-4 w-20"})}),e.jsx(r,{children:e.jsx(m,{className:"h-4 w-24"})}),e.jsx(r,{children:e.jsx(m,{className:"h-4 w-40"})}),e.jsx(r,{children:e.jsx(m,{className:"h-4 w-24"})}),e.jsx(r,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(m,{className:"h-8 w-16"}),e.jsx(m,{className:"h-8 w-16"}),e.jsx(m,{className:"h-8 w-16"})]})})]},t)):y.length?(l._type?y.slice((h-1)*p,h*p):y).map(s=>e.jsxs(w,{children:[e.jsx(r,{className:"font-medium",title:s.description?`${s.label} — ${s.description}`:s.label,children:s.label}),e.jsx(r,{className:"uppercase",children:s._type}),e.jsx(r,{children:s.amount}),e.jsx(r,{className:"text-muted-foreground",children:s.pending_amount}),e.jsx(r,{children:j.find(t=>t.id===s.contact)?.name||s.contact}),e.jsx(r,{children:s.date}),e.jsx(r,{children:s.return_date||"—"}),e.jsx(r,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>Y(s.id),children:"View"}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>{C(s.id),Ee(s.label),Oe(s._type),Ie(String(s.amount)),Ze(s.description||""),Je(s.return_date||""),se(typeof s.payment_method=="number"?s.payment_method:""),Ve(typeof s.payment_source=="number"?s.payment_source:""),He(s.transaction_reference||"")},children:"Edit"}),e.jsx(i,{size:"sm",variant:"destructive",onClick:()=>_(s.id),disabled:be,children:"Delete"})]})})]},s.id)):e.jsx(w,{children:e.jsx(r,{colSpan:7,className:"text-sm text-muted-foreground",children:"No transactions found"})})})]})}),(()=>{const s=Math.max(1,Math.ceil(fe/p));return fe>0?e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>f(t=>Math.max(1,t-1)),disabled:h===1,children:"Prev"}),e.jsxs("span",{className:"text-xs",children:["Page ",h," of ",s]}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>f(t=>Math.min(s,t+1)),disabled:h>=s,children:"Next"})]}):null})()]}),js&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>N(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"new-transaction-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"new-transaction-title",className:"font-semibold",children:"New transaction"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>N(!1),children:"Close"})]}),e.jsxs("form",{onSubmit:async s=>{await gs(s)&&N(!1)},className:"grid gap-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"label",children:"Label"}),e.jsx(o,{id:"label",value:O,onChange:s=>Ne(s.target.value),placeholder:"Loan to John"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"contact",children:"Contact"}),e.jsxs("select",{id:"contact",className:"h-9 rounded-md border bg-background px-3 text-sm",value:W,onChange:s=>ye(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",disabled:!0,children:ns?"Loading…":"Select a contact"}),j.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"type",children:"Type"}),e.jsxs("select",{id:"type",className:"h-9 rounded-md border bg-background px-3 text-sm",value:Ce,onChange:s=>we(s.target.value),children:[e.jsx("option",{value:"credit",children:"Credit"}),e.jsx("option",{value:"debit",children:"Debit"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"amount",children:"Amount"}),e.jsx(o,{id:"amount",type:"number",min:"0",step:"0.01",value:ke,onChange:s=>Se(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"description",children:"Description"}),e.jsx(o,{id:"description",value:_e,onChange:s=>Ae(s.target.value),placeholder:"Optional description"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"returnDate",children:"Return date (optional)"}),e.jsx(o,{id:"returnDate",type:"date",value:ze,onChange:s=>Fe(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"payment-method",children:"Payment method (optional)"}),e.jsxs("select",{id:"payment-method",className:"h-9 rounded-md border bg-background px-3 text-sm",value:I,onChange:s=>U(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:ls?"Loading…":"None"}),v.map(s=>e.jsxs("option",{value:s.id,children:[s.label,s.is_default?" (default)":""]},s.id))]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>K(s=>!s),children:J?"Cancel":"Add new"}),J&&S&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Saving…"})]}),J&&e.jsxs("div",{className:"mt-2 border rounded-md p-2 space-y-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(c,{htmlFor:"new-pm-label",className:"text-xs",children:"New method label"}),e.jsx(o,{id:"new-pm-label",value:V,onChange:s=>G(s.target.value),placeholder:"e.g. Cash",className:"h-8"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:H,onChange:s=>Q(s.target.checked)})," Default"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:Re,onChange:s=>X(s.target.checked)})," Common"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(i,{type:"button",size:"sm",variant:"outline",className:"h-7 px-3",onClick:()=>{K(!1),G(""),Q(!1),X(!1)},children:"Cancel"}),e.jsx(i,{type:"button",size:"sm",className:"h-7 px-3",disabled:S,onClick:async()=>{if(!V.trim()){d.error("Label required");return}if(H&&v.some(s=>s.is_default)){d.error("Only one default method allowed");return}try{const s=await pe({label:V.trim(),is_default:H,is_common:Re}).unwrap();if(s?.status){const t=s.data;U(t.id),d.success(z(s,"Added"))}else d.success("Added");K(!1),G(""),Q(!1),X(!1)}catch(s){d.error(b(s))}},children:"Save"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"payment-source",children:"Payment source (optional)"}),e.jsxs("select",{id:"payment-source",className:"h-9 rounded-md border bg-background px-3 text-sm",value:Z,onChange:s=>B(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:rs?"Loading…":"None"}),$.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:async()=>{const s=prompt("New payment source label?")?.trim();if(s)try{const t=await is({label:s}).unwrap();if(t?.status){const n=t.data;B(n.id),d.success(z(t,"Added"))}else d.success("Added")}catch(t){d.error(b(t))}},children:"Add new"}),ds&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Saving…"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"tx-ref",children:"Reference (optional)"}),e.jsx(o,{id:"tx-ref",value:De,onChange:s=>Pe(s.target.value),placeholder:"e.g., UTR/Ref no."})]}),Le&&e.jsx("div",{className:"text-sm text-red-600",children:Le}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(i,{type:"submit",disabled:ms,children:"Create"})]})]})]})}),$e!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>Y(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"view-transaction-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"view-transaction-title",className:"font-semibold",children:"Transaction details"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>Y(null),children:"Close"})]}),(()=>{const s=q.find(n=>n.id===$e);if(!s)return e.jsx("div",{className:"text-sm",children:"Not found"});const t=j.find(n=>n.id===s.contact)?.name||s.contact;return e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Label:"})," ",s.label]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Contact:"})," ",String(t)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"})," ",s._type]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"})," ",s.amount]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Pending:"})," ",s.pending_amount]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Date:"})," ",s.date]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Return date:"})," ",s.return_date||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Description:"})," ",s.description||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment method:"})," ",v.find(n=>n.id===(s.payment_method??-1))?.label||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment source:"})," ",$.find(n=>n.id===(s.payment_source??-1))?.label||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Reference:"})," ",s.transaction_reference||"—"]})]})})()]})}),Te!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>C(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"edit-transaction-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"edit-transaction-title",className:"font-semibold",children:"Edit transaction"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>C(null),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async s=>{s.preventDefault();try{const t=Te,n=parseFloat(We);await xs({id:t,changes:{label:Me.trim(),_type:qe,amount:n,description:Ue.trim(),return_date:Be||null,payment_method:ee===""?null:Number(ee),payment_source:te===""?null:Number(te),transaction_reference:Ge.trim()||null}}).unwrap(),d.success("Transaction updated"),C(null)}catch(t){d.error(b(t))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-label",children:"Label"}),e.jsx(o,{id:"edit-label",value:Me,onChange:s=>Ee(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-type",children:"Type"}),e.jsxs("select",{id:"edit-type",className:"h-9 rounded-md border bg-background px-3 text-sm",value:qe,onChange:s=>Oe(s.target.value),children:[e.jsx("option",{value:"credit",children:"Credit"}),e.jsx("option",{value:"debit",children:"Debit"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-amount",children:"Amount"}),e.jsx(o,{id:"edit-amount",type:"number",min:"0",step:"0.01",value:We,onChange:s=>Ie(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-description",children:"Description"}),e.jsx(o,{id:"edit-description",value:Ue,onChange:s=>Ze(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-return-date",children:"Return date"}),e.jsx(o,{id:"edit-return-date",type:"date",value:Be,onChange:s=>Je(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-payment-method",children:"Payment method (optional)"}),e.jsxs("select",{id:"edit-payment-method",className:"h-9 rounded-md border bg-background px-3 text-sm",value:ee,onChange:s=>se(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:"None"}),v.map(s=>e.jsxs("option",{value:s.id,children:[s.label,s.is_default?" (default)":""]},s.id))]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>ne(s=>!s),children:ae?"Cancel":"Add new"}),ae&&S&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Saving…"})]}),ae&&e.jsxs("div",{className:"mt-2 border rounded-md p-2 space-y-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(c,{htmlFor:"new-pm-label-edit",className:"text-xs",children:"New method label"}),e.jsx(o,{id:"new-pm-label-edit",value:le,onChange:s=>re(s.target.value),placeholder:"e.g. Cash",className:"h-8"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:ie,onChange:s=>de(s.target.checked)})," Default"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:Qe,onChange:s=>ce(s.target.checked)})," Common"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(i,{type:"button",size:"sm",variant:"outline",className:"h-7 px-3",onClick:()=>{ne(!1),re(""),de(!1),ce(!1)},children:"Cancel"}),e.jsx(i,{type:"button",size:"sm",className:"h-7 px-3",disabled:S,onClick:async()=>{if(!le.trim()){d.error("Label required");return}if(ie&&v.some(s=>s.is_default)){d.error("Only one default method allowed");return}try{const s=await pe({label:le.trim(),is_default:ie,is_common:Qe}).unwrap();if(s?.status){const t=s.data;se(t.id),d.success(z(s,"Added"))}else d.success("Added");ne(!1),re(""),de(!1),ce(!1)}catch(s){d.error(b(s))}},children:"Save"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-payment-source",children:"Payment source (optional)"}),e.jsxs("select",{id:"edit-payment-source",className:"h-9 rounded-md border bg-background px-3 text-sm",value:te,onChange:s=>Ve(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:"None"}),$.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-tx-ref",children:"Reference (optional)"}),e.jsx(o,{id:"edit-tx-ref",value:Ge,onChange:s=>He(s.target.value),placeholder:"e.g., UTR/Ref no."})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>C(null),children:"Cancel"}),e.jsx(i,{type:"submit",disabled:hs,children:"Save"})]})]})]})}),Ke!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>_(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"delete-transaction-title",className:"bg-background rounded-md p-4 w-[420px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{id:"delete-transaction-title",className:"font-semibold mb-2",children:"Delete transaction"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(i,{variant:"outline",onClick:()=>_(null),children:"Cancel"}),e.jsx(i,{variant:"destructive",disabled:be,onClick:async()=>{try{await ps(Ke).unwrap(),d.success("Transaction deleted")}catch(s){d.error(b(s))}finally{_(null)}},children:"Delete"})]})]})})]})};export{Ms as default};
