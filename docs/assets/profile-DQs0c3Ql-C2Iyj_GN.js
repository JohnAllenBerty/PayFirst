import{V as $,W as B,v as l,R as y,x as e,n as P,a as F,i as L,X as U,P as C,I as M,r as R,$ as I,a0 as X,a1 as Z,z as p,j as N,Z as v}from"./index-DnKD0KXe.js";import{o}from"./skeleton-mX7TdaWE-Cq_BwO7K.js";import{a as q}from"./useMeta-Do0ZXGYI-DbPzVoKD.js";const V=()=>{const{data:t,isLoading:i,refetch:d}=$(),{title:h}=q("/profile","Profile • PayFirst"),[f,{isLoading:g}]=B(),x=l.useMemo(()=>{const r=t;return r&&r.status===!1?y(r):null},[t]),s=t&&typeof t!="string"&&t.status?t.data:null,u=l.useMemo(()=>s?[s.first_name,s.last_name].filter(Boolean).join(" ").trim()||s.user:"Profile",[s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:h.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your account information."})]}),x&&e.jsxs("div",{className:"rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700 flex items-center justify-between gap-3",children:[e.jsx("span",{children:x}),e.jsx("button",{className:"h-8 rounded-md border px-3 text-sm",onClick:()=>d(),children:"Retry"})]}),i?e.jsxs(P,{className:"max-w-xl",children:[e.jsxs(F,{children:[e.jsx(o,{className:"h-6 w-40"}),e.jsx(o,{className:"h-4 w-64"})]}),e.jsxs(L,{className:"space-y-3",children:[e.jsx(o,{className:"h-9 w-full"}),e.jsx(o,{className:"h-9 w-full"}),e.jsx(o,{className:"h-9 w-full"})]}),e.jsx(U,{className:"justify-end",children:e.jsx(o,{className:"h-9 w-20"})})]}):s?e.jsx(E,{user:s.user,first_name:s.first_name,last_name:s.last_name,date_joined:s.date_joined,last_login:s.last_login,displayName:u,onSave:async r=>{try{const a=await f(r).unwrap();C.success(M(a,"Profile updated"))}catch(a){throw C.error(y(a)),a}},saving:g}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No profile data"})]})};function E({user:t,first_name:i,last_name:d,date_joined:h,last_login:f,displayName:g,onSave:x,saving:s}){const[u,r]=l.useState(!1),[a,w]=l.useState(t),[c,_]=l.useState(i),[m,b]=l.useState(d),[S,j]=l.useState(null),k=l.useMemo(()=>[c||i,m||d].filter(Boolean).map(n=>(n||"").trim()[0]).filter(Boolean).join("").slice(0,2)||(a||"U")[0]?.toUpperCase()||"U",[c,m,a,i,d]),z=(a!==t||c!==i||m!==d)&&!!a.trim();return e.jsxs(P,{className:"max-w-xl",children:[e.jsxs(F,{children:[e.jsxs(R,{className:"flex items-center gap-3",children:[e.jsx(I,{className:"h-8 w-8 rounded-lg",children:e.jsx(X,{className:"rounded-lg",children:k})}),g]}),e.jsx(Z,{children:"Update your account information."})]}),e.jsxs(L,{className:"grid gap-4",children:[e.jsxs("div",{className:"text-xs text-muted-foreground grid gap-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Joined:"})," ",new Date(h).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Last login:"})," ",new Date(f).toLocaleString()]})]}),u?e.jsxs("form",{className:"grid gap-3",onSubmit:async n=>{if(n.preventDefault(),j(null),!a.trim()){j("User is required");return}try{await x({user:a.trim(),first_name:c.trim(),last_name:m.trim()}),r(!1)}catch(D){j(y(D))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"u",children:"User"}),e.jsx(N,{id:"u",value:a,onChange:n=>w(n.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"f",children:"First name"}),e.jsx(N,{id:"f",value:c,onChange:n=>_(n.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"l",children:"Last name"}),e.jsx(N,{id:"l",value:m,onChange:n=>b(n.target.value)})]}),S&&e.jsx("div",{className:"text-sm text-red-600",children:S}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>{w(t),_(i),b(d),j(null),r(!1)},children:"Cancel"}),e.jsx(v,{type:"submit",disabled:s||!z,children:s?"Saving…":"Save"})]})]}):e.jsxs("div",{className:"grid gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"User"}),e.jsx("span",{children:a})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"First name"}),e.jsx("span",{children:c||"—"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last name"}),e.jsx("span",{children:m||"—"})]})]})]}),e.jsx(U,{className:"justify-end",children:!u&&e.jsx(v,{size:"sm",onClick:()=>r(!0),children:"Edit"})})]})}export{V as default};
