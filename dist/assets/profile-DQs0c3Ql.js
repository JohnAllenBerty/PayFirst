import{Y as _,Z as A,r as l,k as y,j as e,C as L,b as U,d as M,_ as E,y as F,i as I,c as R,$ as T,a0 as Y,a1 as $,L as g,I as N,B as v}from"./index-BbQ3UlKF.js";import{S as u}from"./skeleton-mX7TdaWE.js";import{u as q}from"./useMeta-Do0ZXGYI.js";const G=()=>{const{data:t,isLoading:i,refetch:c}=_(),{title:h}=q("/profile","Profile • PayFirst"),[f,{isLoading:p}]=A(),m=l.useMemo(()=>{const r=t;return r&&r.status===!1?y(r):null},[t]),s=t&&typeof t!="string"&&t.status?t.data:null,x=l.useMemo(()=>s?[s.first_name,s.last_name].filter(Boolean).join(" ").trim()||s.user:"Profile",[s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:h.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your account information."})]}),m&&e.jsxs("div",{className:"rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700 flex items-center justify-between gap-3",children:[e.jsx("span",{children:m}),e.jsx("button",{className:"h-8 rounded-md border px-3 text-sm",onClick:()=>c(),children:"Retry"})]}),i?e.jsxs(L,{className:"max-w-xl",children:[e.jsxs(U,{children:[e.jsx(u,{className:"h-6 w-40"}),e.jsx(u,{className:"h-4 w-64"})]}),e.jsxs(M,{className:"space-y-3",children:[e.jsx(u,{className:"h-9 w-full"}),e.jsx(u,{className:"h-9 w-full"}),e.jsx(u,{className:"h-9 w-full"})]}),e.jsx(E,{className:"justify-end",children:e.jsx(u,{className:"h-9 w-20"})})]}):s?e.jsx(z,{user:s.user,first_name:s.first_name,last_name:s.last_name,date_joined:s.date_joined,last_login:s.last_login,displayName:x,onSave:async r=>{try{const a=await f(r).unwrap();F.success(I(a,"Profile updated"))}catch(a){throw F.error(y(a)),a}},saving:p}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No profile data"})]})};function z({user:t,first_name:i,last_name:c,date_joined:h,last_login:f,displayName:p,onSave:m,saving:s}){const[x,r]=l.useState(!1),[a,w]=l.useState(t),[d,b]=l.useState(i),[o,C]=l.useState(c),[S,j]=l.useState(null),k=l.useMemo(()=>[d||i,o||c].filter(Boolean).map(B=>(B||"").trim()[0]).filter(Boolean).join("").slice(0,2)||(a||"U")[0]?.toUpperCase()||"U",[d,o,a,i,c]),D=(a!==t||d!==i||o!==c)&&!!a.trim();return e.jsxs(L,{className:"max-w-xl",children:[e.jsxs(U,{children:[e.jsxs(R,{className:"flex items-center gap-3",children:[e.jsx(T,{className:"h-8 w-8 rounded-lg",children:e.jsx(Y,{className:"rounded-lg",children:k})}),p]}),e.jsx($,{children:"Update your account information."})]}),e.jsxs(M,{className:"grid gap-4",children:[e.jsxs("div",{className:"text-xs text-muted-foreground grid gap-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Joined:"})," ",new Date(h).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Last login:"})," ",new Date(f).toLocaleString()]})]}),x?e.jsxs("form",{className:"grid gap-3",onSubmit:async n=>{if(n.preventDefault(),j(null),!a.trim()){j("User is required");return}try{await m({user:a.trim(),first_name:d.trim(),last_name:o.trim()}),r(!1)}catch(P){j(y(P))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"u",children:"User"}),e.jsx(N,{id:"u",value:a,onChange:n=>w(n.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"f",children:"First name"}),e.jsx(N,{id:"f",value:d,onChange:n=>b(n.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"l",children:"Last name"}),e.jsx(N,{id:"l",value:o,onChange:n=>C(n.target.value)})]}),S&&e.jsx("div",{className:"text-sm text-red-600",children:S}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>{w(t),b(i),C(c),j(null),r(!1)},children:"Cancel"}),e.jsx(v,{type:"submit",disabled:s||!D,children:s?"Saving…":"Save"})]})]}):e.jsxs("div",{className:"grid gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"User"}),e.jsx("span",{children:a})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"First name"}),e.jsx("span",{children:d||"—"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last name"}),e.jsx("span",{children:o||"—"})]})]})]}),e.jsx(E,{className:"justify-end",children:!x&&e.jsx(v,{size:"sm",onClick:()=>r(!0),children:"Edit"})})]})}export{G as default};
