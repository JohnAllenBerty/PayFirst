import{r as a,J as hs,E as ps,F as gs,G as js,H as fs,O as bs,Q as ys,S as vs,T as Ns,y as i,j as e,B as l,I as m,L as c,i as j,k as f}from"./index-BbQ3UlKF.js";import{u as ks}from"./useMeta-Do0ZXGYI.js";import{S as x}from"./skeleton-mX7TdaWE.js";import{T as ws,b as Cs,c as w,d as b,A as le,a as ie,e as d,f as Ss}from"./table-DQfnjL0Y.js";import{S as As}from"./search-B37cGDDG.js";const Fs=()=>{const{title:Ge}=ks("/repayments","Repayments • PayFirst"),[C,y]=a.useState(1),[M,Je]=a.useState(10),[h,z]=a.useState("label"),[Ke,de]=a.useState(0),[L,Xe]=a.useState(""),[F,Ye]=a.useState(""),[u,ce]=a.useState({}),{data:oe,isLoading:es}=hs({page_size:1e3}),{data:me,isLoading:ss}=ps({page_size:1e3}),[ue,{isLoading:S}]=gs(),{data:xe,isLoading:ts}=js({page_size:1e3}),[as,{isLoading:ns}]=fs(),p=a.useMemo(()=>{const s=oe;if(!s)return[];if(s.status===!0){const r=s.data;if(Array.isArray(r))return r;const o=r;return Array.isArray(o.results)?o.results:[]}if(s.status===!1)return[];const t=s;return Array.isArray(t.results)?t.results:[]},[oe]),v=a.useMemo(()=>{const s=me;if(!s)return[];if(s.status===!0){const r=s.data;if(Array.isArray(r))return r;const o=r;return Array.isArray(o.results)?o.results:[]}if(s.status===!1)return[];const t=s;return Array.isArray(t.results)?t.results:[]},[me]),T=a.useMemo(()=>{const s=xe;if(!s)return[];if(s.status===!1)return[];if(s.status===!0){const r=s.data;if(Array.isArray(r))return r;const o=r;return Array.isArray(o.results)?o.results:[]}const t=s;return Array.isArray(t.results)?t.results:[]},[xe]),rs=a.useMemo(()=>{const s=[];if(u.label&&s.push(u.label),typeof u.transaction=="number"){const t=p.find(n=>n.id===u.transaction);t?.label&&s.push(t.label)}return s.join(" ").trim()||void 0},[u,p]),{data:A,isLoading:_,isFetching:ls}=bs({page:C,page_size:M,ordering:h,refresh:Ke,search:rs}),[is,{isLoading:ds}]=ys(),[cs,{isLoading:os}]=vs(),[ms,{isLoading:he}]=Ns(),pe=a.useMemo(()=>{const s=A;if(!s)return{items:[],total:0};if(s.status===!0){const r=s.data;if(Array.isArray(r))return{items:r,total:r.length};const o=r;return Array.isArray(o.results)?{items:o.results,total:o.count??o.results.length}:{items:[],total:0}}if(s.status===!1)return{items:[],total:0};const t=s;return Array.isArray(t.results)?{items:t.results,total:t.count??t.results.length}:{items:[],total:0}},[A]),P=pe.items,ge=pe.total,je=a.useMemo(()=>{const s=A;return s&&s.status===!1?String(s.error??"Server error"):null},[A]),[E,fe]=a.useState(""),[D,be]=a.useState(""),[ye,ve]=a.useState(""),[Ne,ke]=a.useState(""),[we,Ce]=a.useState(""),[I,Q]=a.useState(""),[O,$]=a.useState(""),[Se,Ae]=a.useState(""),[q,B]=a.useState(!1),[U,H]=a.useState(""),[W,V]=a.useState(!1),[Pe,Z]=a.useState(!1),[Re,g]=a.useState(null),[us,N]=a.useState(!1),[Me,G]=a.useState(null),[ze,k]=a.useState(null),[Le,Fe]=a.useState(""),[Te,_e]=a.useState(""),[Ee,De]=a.useState(""),[Ie,Qe]=a.useState(""),[Oe,$e]=a.useState(""),[J,K]=a.useState(""),[X,qe]=a.useState(""),[Be,Ue]=a.useState(""),[Y,ee]=a.useState(!1),[se,te]=a.useState(""),[ae,ne]=a.useState(!1),[He,re]=a.useState(!1),We=a.useRef("");a.useEffect(()=>{if(_||!!!(u.label||typeof u.transaction=="number"))return;const t=`${u.label||""}|${u.transaction||""}`;P.length===0&&We.current!==t&&(We.current=t,i.info("No repayments match your filters. Adjust or clear filters to see results."))},[_,P.length,u]);const[Ve,R]=a.useState(null),xs=async s=>{if(s.preventDefault(),g(null),!E.trim())return g("Label is required"),!1;if(D==="")return g("Transaction is required"),!1;const t=parseFloat(ye);if(!isFinite(t)||t<=0)return g("Amount must be > 0"),!1;try{const n=await is({label:E.trim(),transaction:Number(D),amount:t,remarks:Ne.trim(),date:we||new Date().toISOString().slice(0,10),payment_method:I===""?null:Number(I),payment_source:O===""?null:Number(O),transaction_reference:Se.trim()||null}).unwrap();return fe(""),be(""),ve(""),ke(""),Ce(""),Q(""),$(""),Ae(""),i.success(j(n,"Repayment created")),de(r=>r+1),!0}catch(n){const r=f(n);return g(r),i.error(r),!1}},Ze=P;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:Ge.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Record repayments against transactions."})]}),je&&e.jsxs("div",{className:"max-w-xl rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700 flex items-center justify-between gap-3",children:[e.jsx("span",{children:je}),e.jsx(l,{type:"button",size:"sm",variant:"outline",onClick:()=>de(s=>s+1),children:"Retry"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{}),e.jsx(l,{size:"sm",onClick:()=>{N(!0),g(null)},children:"New Repayment"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"font-medium",children:"All repayments"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-muted-foreground",htmlFor:"rep-page-size",children:"Rows per page"}),e.jsxs("select",{id:"rep-page-size",className:"h-8 rounded-md border bg-background px-2 text-sm",value:M,onChange:s=>{Je(Number(s.target.value)),y(1)},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(ws,{children:[e.jsxs(Cs,{children:[e.jsxs(w,{children:[e.jsx(b,{className:"cursor-pointer select-none","aria-label":"Sort by label",onClick:()=>z(s=>s==="label"?"-label":"label"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Label ",h.includes("label")&&(h.startsWith("-")?e.jsx(le,{className:"size-4"}):e.jsx(ie,{className:"size-4"}))]})}),e.jsx(b,{className:"cursor-pointer select-none","aria-label":"Sort by amount",onClick:()=>z(s=>s==="amount"?"-amount":"amount"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Amount ",h.includes("amount")&&(h.startsWith("-")?e.jsx(le,{className:"size-4"}):e.jsx(ie,{className:"size-4"}))]})}),e.jsx(b,{className:"cursor-pointer select-none","aria-label":"Sort by date",onClick:()=>z(s=>s==="date"?"-date":"date"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Date ",h.includes("date")&&(h.startsWith("-")?e.jsx(le,{className:"size-4"}):e.jsx(ie,{className:"size-4"}))]})}),e.jsx(b,{children:"Remarks"}),e.jsx(b,{children:"Transaction"}),e.jsx(b,{className:"w-[1%] whitespace-nowrap text-right pr-3",children:"Actions"})]}),e.jsxs(w,{children:[e.jsx(d,{children:e.jsxs("div",{className:"relative",children:[e.jsx(m,{value:L,onChange:s=>Xe(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),ce({...u,label:L.trim()||void 0}),y(1))},placeholder:"Filter label…",className:"pl-8 h-8"}),e.jsx(As,{className:"absolute left-2 top-2 size-4 text-muted-foreground"})]})}),e.jsx(d,{}),e.jsx(d,{}),e.jsx(d,{}),e.jsx(d,{children:e.jsxs("select",{className:"h-8 rounded-md border bg-background px-2 text-sm",value:F,onChange:s=>Ye(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:"All transactions"}),p.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]})}),e.jsx(d,{className:"text-right pr-3",children:e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2",disabled:ls,onClick:()=>{const s={},t=L.trim();t&&(s.label=t),typeof F=="number"&&(s.transaction=F),ce(s),y(1)},children:"Apply"})})]})]}),e.jsx(Ss,{children:_?Array.from({length:5}).map((s,t)=>e.jsxs(w,{children:[e.jsx(d,{children:e.jsx(x,{className:"h-4 w-40"})}),e.jsx(d,{children:e.jsx(x,{className:"h-4 w-24"})}),e.jsx(d,{children:e.jsx(x,{className:"h-4 w-24"})}),e.jsx(d,{children:e.jsx(x,{className:"h-4 w-32"})}),e.jsx(d,{children:e.jsx(x,{className:"h-4 w-40"})}),e.jsx(d,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(x,{className:"h-8 w-16"}),e.jsx(x,{className:"h-8 w-16"}),e.jsx(x,{className:"h-8 w-16"})]})})]},t)):Ze.length?Ze.map(s=>e.jsxs(w,{children:[e.jsx(d,{className:"font-medium",title:s.remarks?`${s.label} — ${s.remarks}`:s.label,children:s.label}),e.jsx(d,{children:s.amount}),e.jsx(d,{children:s.date}),e.jsx(d,{className:"text-muted-foreground",children:s.remarks||"—"}),e.jsx(d,{children:p.find(t=>t.id===s.transaction)?.label||s.transaction}),e.jsx(d,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>G(s.id),children:"View"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{k(s.id),Fe(s.label),_e(s.transaction),De(String(s.amount)),Qe(s.remarks||""),$e(s.date),K(typeof s.payment_method=="number"?s.payment_method:""),qe(typeof s.payment_source=="number"?s.payment_source:""),Ue(s.transaction_reference||"")},children:"Edit"}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>R(s.id),disabled:he,children:"Delete"})]})})]},s.id)):e.jsx(w,{children:e.jsx(d,{colSpan:6,className:"text-sm text-muted-foreground",children:"No repayments found"})})})]})}),(()=>{const s=Math.max(1,Math.ceil(ge/M));return ge>0?e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>y(t=>Math.max(1,t-1)),disabled:C===1,children:"Prev"}),e.jsxs("span",{className:"text-xs",children:["Page ",C," of ",s]}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>y(t=>Math.min(s,t+1)),disabled:C>=s,children:"Next"})]}):null})()]}),us&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>N(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"new-repayment-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"new-repayment-title",className:"font-semibold",children:"New repayment"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>N(!1),children:"Close"})]}),e.jsxs("form",{onSubmit:async s=>{await xs(s)&&N(!1)},className:"grid gap-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"label",children:"Label"}),e.jsx(m,{id:"label",value:E,onChange:s=>fe(s.target.value),placeholder:"Repayment 1"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"transaction",children:"Transaction"}),e.jsxs("select",{id:"transaction",className:"h-9 rounded-md border bg-background px-3 text-sm",value:D,onChange:s=>be(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",disabled:!0,children:es?"Loading…":"Select a transaction"}),p.map(s=>e.jsxs("option",{value:s.id,children:[s.label," (",s._type," ",s.amount,")"]},s.id))]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"amount",children:"Amount"}),e.jsx(m,{id:"amount",type:"number",min:"0",step:"0.01",value:ye,onChange:s=>ve(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"remarks",children:"Remarks"}),e.jsx(m,{id:"remarks",value:Ne,onChange:s=>ke(s.target.value),placeholder:"Optional remarks"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"date",children:"Date"}),e.jsx(m,{id:"date",type:"date",value:we,onChange:s=>Ce(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"payment-method",children:"Payment method (optional)"}),e.jsxs("select",{id:"payment-method",className:"h-9 rounded-md border bg-background px-3 text-sm",value:I,onChange:s=>Q(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:ss?"Loading…":"None"}),v.map(s=>e.jsxs("option",{value:s.id,children:[s.label,s.is_default?" (default)":""]},s.id))]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>B(s=>!s),children:q?"Cancel":"Add new"}),q&&S&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Saving…"})]}),q&&e.jsxs("div",{className:"mt-2 border rounded-md p-2 space-y-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(c,{htmlFor:"new-pm-label",className:"text-xs",children:"New method label"}),e.jsx(m,{id:"new-pm-label",value:U,onChange:s=>H(s.target.value),placeholder:"e.g. Cash",className:"h-8"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:W,onChange:s=>V(s.target.checked)})," Default"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:Pe,onChange:s=>Z(s.target.checked)})," Common"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{type:"button",size:"sm",variant:"outline",className:"h-7 px-3",onClick:()=>{B(!1),H(""),V(!1),Z(!1)},children:"Cancel"}),e.jsx(l,{type:"button",size:"sm",className:"h-7 px-3",disabled:S,onClick:async()=>{if(!U.trim()){i.error("Label required");return}if(W&&v.some(s=>s.is_default)){i.error("Only one default method allowed");return}try{const s=await ue({label:U.trim(),is_default:W,is_common:Pe}).unwrap();if(s?.status){const t=s.data;Q(t.id),i.success(j(s,"Added"))}else i.success("Added");B(!1),H(""),V(!1),Z(!1)}catch(s){i.error(f(s))}},children:"Save"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"payment-source",children:"Payment source (optional)"}),e.jsxs("select",{id:"payment-source",className:"h-9 rounded-md border bg-background px-3 text-sm",value:O,onChange:s=>$(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:ts?"Loading…":"None"}),T.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:async()=>{const s=prompt("New payment source label?")?.trim();if(s)try{const t=await as({label:s}).unwrap();if(t?.status){const n=t.data;$(n.id),i.success(j(t,"Added"))}else i.success("Added")}catch(t){i.error(f(t))}},children:"Add new"}),ns&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Saving…"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"tx-ref",children:"Reference (optional)"}),e.jsx(m,{id:"tx-ref",value:Se,onChange:s=>Ae(s.target.value),placeholder:"e.g., UTR/Ref no."})]}),Re&&e.jsx("div",{className:"text-sm text-red-600",children:Re}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:ds,children:"Create"})]})]})]})}),Me!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>G(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"view-repayment-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"view-repayment-title",className:"font-semibold",children:"Repayment details"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>G(null),children:"Close"})]}),(()=>{const s=P.find(n=>n.id===Me);if(!s)return e.jsx("div",{className:"text-sm",children:"Not found"});const t=p.find(n=>n.id===s.transaction)?.label||s.transaction;return e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Label:"})," ",s.label]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Transaction:"})," ",String(t)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"})," ",s.amount]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Date:"})," ",s.date]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Remarks:"})," ",s.remarks||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment method:"})," ",v.find(n=>n.id===(s.payment_method??-1))?.label||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment source:"})," ",T.find(n=>n.id===(s.payment_source??-1))?.label||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Reference:"})," ",s.transaction_reference||"—"]})]})})()]})}),ze!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>k(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"edit-repayment-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"edit-repayment-title",className:"font-semibold",children:"Edit repayment"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>k(null),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async s=>{s.preventDefault();try{const t=ze,n=parseFloat(Ee),r=await cs({id:t,changes:{label:Le.trim(),transaction:Te,amount:n,remarks:Ie.trim(),date:Oe,payment_method:J===""?null:Number(J),payment_source:X===""?null:Number(X),transaction_reference:Be.trim()||null}}).unwrap();i.success(j(r,"Repayment updated")),k(null)}catch(t){const n=f(t);i.error(n)}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-label",children:"Label"}),e.jsx(m,{id:"edit-label",value:Le,onChange:s=>Fe(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-payment-source",children:"Payment source (optional)"}),e.jsxs("select",{id:"edit-payment-source",className:"h-9 rounded-md border bg-background px-3 text-sm",value:X,onChange:s=>qe(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:"None"}),T.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-tx-ref",children:"Reference (optional)"}),e.jsx(m,{id:"edit-tx-ref",value:Be,onChange:s=>Ue(s.target.value),placeholder:"e.g., UTR/Ref no."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-transaction",children:"Transaction"}),e.jsxs("select",{id:"edit-transaction",className:"h-9 rounded-md border bg-background px-3 text-sm",value:Te,onChange:s=>_e(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",disabled:!0,children:"Select a transaction"}),p.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-amount",children:"Amount"}),e.jsx(m,{id:"edit-amount",type:"number",min:"0",step:"0.01",value:Ee,onChange:s=>De(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-remarks",children:"Remarks"}),e.jsx(m,{id:"edit-remarks",value:Ie,onChange:s=>Qe(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-date",children:"Date"}),e.jsx(m,{id:"edit-date",type:"date",value:Oe,onChange:s=>$e(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"edit-payment-method",children:"Payment method (optional)"}),e.jsxs("select",{id:"edit-payment-method",className:"h-9 rounded-md border bg-background px-3 text-sm",value:J,onChange:s=>K(s.target.value?Number(s.target.value):""),children:[e.jsx("option",{value:"",children:"None"}),v.map(s=>e.jsxs("option",{value:s.id,children:[s.label,s.is_default?" (default)":""]},s.id))]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>ee(s=>!s),children:Y?"Cancel":"Add new"}),Y&&S&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Saving…"})]}),Y&&e.jsxs("div",{className:"mt-2 border rounded-md p-2 space-y-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(c,{htmlFor:"new-pm-label-edit",className:"text-xs",children:"New method label"}),e.jsx(m,{id:"new-pm-label-edit",value:se,onChange:s=>te(s.target.value),placeholder:"e.g. Cash",className:"h-8"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:ae,onChange:s=>ne(s.target.checked)})," Default"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:He,onChange:s=>re(s.target.checked)})," Common"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{type:"button",size:"sm",variant:"outline",className:"h-7 px-3",onClick:()=>{ee(!1),te(""),ne(!1),re(!1)},children:"Cancel"}),e.jsx(l,{type:"button",size:"sm",className:"h-7 px-3",disabled:S,onClick:async()=>{if(!se.trim()){i.error("Label required");return}if(ae&&v.some(s=>s.is_default)){i.error("Only one default method allowed");return}try{const s=await ue({label:se.trim(),is_default:ae,is_common:He}).unwrap();if(s?.status){const t=s.data;K(t.id),i.success(j(s,"Added"))}else i.success("Added");ee(!1),te(""),ne(!1),re(!1)}catch(s){i.error(f(s))}},children:"Save"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>k(null),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:os,children:"Save"})]})]})]})}),Ve!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>R(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"delete-repayment-title",className:"bg-background rounded-md p-4 w-[420px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{id:"delete-repayment-title",className:"font-semibold mb-2",children:"Delete repayment"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>R(null),children:"Cancel"}),e.jsx(l,{variant:"destructive",disabled:he,onClick:async()=>{try{const s=await ms(Ve).unwrap();i.success(j(s,"Repayment deleted"))}catch(s){const t=f(s);i.error(t)}finally{R(null)}},children:"Delete"})]})]})})]})};export{Fs as default};
