import{m as nt,r as n,j as e,n as rt,P as it,o as ue,p as lt,q as Ge,s as Fe,t as ot,v as ct,w as dt,e as ut,x as mt,z as pt,A as xt,D as ht,y as P,B as l,I as Y,L as R,i as ee,k as te,R as ft,l as gt}from"./index-C7wzcO-q.js";import{S as H}from"./skeleton-CxZLnZh4.js";import{T as jt,b as bt,c as K,d as de,A as vt,a as Nt,e as I,f as Ct}from"./table-CnnrqGGu.js";import{u as kt}from"./useMeta-RQawy8vu.js";import{F as yt,L as wt,C as St}from"./layout-list-KhjbPwAW.js";import{S as Le}from"./search-BQi7r64N.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Et=nt("check",zt);function Pt(i){const d=n.useRef({value:i,previous:i});return n.useMemo(()=>(d.current.value!==i&&(d.current.previous=d.current.value,d.current.value=i),d.current.previous),[i])}var se="Checkbox",[It,Bt]=rt(se),[_t,me]=It(se);function Mt(i){const{__scopeCheckbox:d,checked:p,children:u,defaultChecked:x,disabled:c,form:h,name:v,onCheckedChange:m,required:k,value:j="on",internal_do_not_use_render:f}=i,[N,_]=lt({prop:p,defaultProp:x??!1,onChange:m,caller:se}),[C,y]=n.useState(null),[M,o]=n.useState(null),g=n.useRef(!1),B=C?!!h||!!C.closest("form"):!0,O={checked:N,disabled:c,setChecked:_,control:C,setControl:y,name:v,form:h,value:j,hasConsumerStoppedPropagationRef:g,required:k,defaultChecked:A(x)?!1:x,isFormControl:B,bubbleInput:M,setBubbleInput:o};return e.jsx(_t,{scope:d,...O,children:Rt(f)?f(O):u})}var Be="CheckboxTrigger",Oe=n.forwardRef(({__scopeCheckbox:i,onKeyDown:d,onClick:p,...u},x)=>{const{control:c,value:h,disabled:v,checked:m,required:k,setControl:j,setChecked:f,hasConsumerStoppedPropagationRef:N,isFormControl:_,bubbleInput:C}=me(Be,i),y=Ge(x,j),M=n.useRef(m);return n.useEffect(()=>{const o=c?.form;if(o){const g=()=>f(M.current);return o.addEventListener("reset",g),()=>o.removeEventListener("reset",g)}},[c,f]),e.jsx(ue.button,{type:"button",role:"checkbox","aria-checked":A(m)?"mixed":m,"aria-required":k,"data-state":$e(m),"data-disabled":v?"":void 0,disabled:v,value:h,...u,ref:y,onKeyDown:Fe(d,o=>{o.key==="Enter"&&o.preventDefault()}),onClick:Fe(p,o=>{f(g=>A(g)?!0:!g),C&&_&&(N.current=o.isPropagationStopped(),N.current||o.stopPropagation())})})});Oe.displayName=Be;var Ve=n.forwardRef((i,d)=>{const{__scopeCheckbox:p,name:u,checked:x,defaultChecked:c,required:h,disabled:v,value:m,onCheckedChange:k,form:j,...f}=i;return e.jsx(Mt,{__scopeCheckbox:p,checked:x,defaultChecked:c,disabled:v,required:h,onCheckedChange:k,name:u,form:j,value:m,internal_do_not_use_render:({isFormControl:N})=>e.jsxs(e.Fragment,{children:[e.jsx(Oe,{...f,ref:d,__scopeCheckbox:p}),N&&e.jsx(Ke,{__scopeCheckbox:p})]})})});Ve.displayName=se;var qe="CheckboxIndicator",Ue=n.forwardRef((i,d)=>{const{__scopeCheckbox:p,forceMount:u,...x}=i,c=me(qe,p);return e.jsx(it,{present:u||A(c.checked)||c.checked===!0,children:e.jsx(ue.span,{"data-state":$e(c.checked),"data-disabled":c.disabled?"":void 0,...x,ref:d,style:{pointerEvents:"none",...i.style}})})});Ue.displayName=qe;var He="CheckboxBubbleInput",Ke=n.forwardRef(({__scopeCheckbox:i,...d},p)=>{const{control:u,hasConsumerStoppedPropagationRef:x,checked:c,defaultChecked:h,required:v,disabled:m,name:k,value:j,form:f,bubbleInput:N,setBubbleInput:_}=me(He,i),C=Ge(p,_),y=Pt(c),M=ot(u);n.useEffect(()=>{const g=N;if(!g)return;const B=window.HTMLInputElement.prototype,$=Object.getOwnPropertyDescriptor(B,"checked").set,ae=!x.current;if(y!==c&&$){const ne=new Event("click",{bubbles:ae});g.indeterminate=A(c),$.call(g,A(c)?!1:c),g.dispatchEvent(ne)}},[N,y,c,x]);const o=n.useRef(A(c)?!1:c);return e.jsx(ue.input,{type:"checkbox","aria-hidden":!0,defaultChecked:h??o.current,required:v,disabled:m,name:k,value:j,form:f,...d,tabIndex:-1,ref:C,style:{...d.style,...M,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Ke.displayName=He;function Rt(i){return typeof i=="function"}function A(i){return i==="indeterminate"}function $e(i){return A(i)?"indeterminate":i?"checked":"unchecked"}function Te({className:i,...d}){return e.jsx(Ve,{"data-slot":"checkbox",className:ct("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",i),...d,children:e.jsx(Ue,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(Et,{className:"size-3.5"})})})}const Ot=()=>{const[i,d]=n.useState("name"),[p,u]=n.useState(1),[x,c]=n.useState(10),[h,v]=n.useState(!1),[m,k]=n.useState(""),[j,f]=n.useState({name:""}),[N,_]=n.useState(0),{data:C,isLoading:y,isFetching:M}=dt({page:h?1:p,page_size:h?1e3:x,ordering:i,search:j.name||void 0,refresh:N}),{data:o,isLoading:g,refetch:B}=ut(),[O,{isLoading:$}]=mt(),[ae,{isLoading:ne}]=pt(),[Qe,{isLoading:Q}]=xt(),[re,pe]=n.useState(""),[xe,he]=n.useState([]),[fe,J]=n.useState(null),[Je,V]=n.useState(!1),[ge,je]=n.useState(null),[be,q]=n.useState(null),[ve,D]=n.useState(null),[Ne,X]=n.useState(""),[Ce,Z]=n.useState([]),[ke,T]=n.useState(null),[ye,Xe]=n.useState(null),[Ze,U]=n.useState(!1),[we,Se]=n.useState(null),[ze,We]=n.useState("google"),[Ye,{isLoading:Ee}]=ht(),b=n.useMemo(()=>o&&typeof o!="string"&&o?.status?o?.data:[],[o]),Pe=n.useMemo(()=>{const t=C;if(!t)return{items:[],total:0};if(t.status===!0){const r=t.data;return Array.isArray(r)?{items:r,total:r.length}:{items:r.results??[],total:r.count??(r.results?r.results.length:0)}}if(t.status===!1)return{items:[],total:0};const s=t;return Array.isArray(s.results)?{items:s.results,total:s.count}:{items:[],total:0}},[C]),F=Pe.items,W=Pe.total,Ie=typeof o=="string"?o:o&&typeof o!="string"&&o.status===!1?String(o.error??"Server error"):null,_e=(()=>{const t=C;return t&&t.status===!1?String(t.error??"Server error"):null})(),et=(t,s)=>{he(a=>s?Array.from(new Set([...a,t])):a.filter(r=>r!==t))},tt=async t=>{if(t.preventDefault(),J(null),!re.trim())return J("Name is required"),!1;try{const s=new FormData;s.append("name",re.trim()),xe.forEach(r=>s.append("groups",String(r))),ge&&s.append("picture",ge);const a=await O(s).unwrap();return pe(""),he([]),je(null),P.success(ee(a,"Contact created")),!0}catch(s){const a=te(s);return J(a),P.error(a),!1}},Me=n.useMemo(()=>Array.isArray(b)&&b.some(t=>Array.isArray(t.subgroups)&&t.subgroups.length>0),[b]),Re=n.useMemo(()=>{if(!b)return[];if(Me){const a=r=>({id:r.id,name:r.name,parent_group:r.parent_group??null,children:Array.isArray(r.subgroups)?r.subgroups.map(a):[]});return b.map(a)}const t=new Map,s=[];return b.forEach(a=>t.set(a.id,{id:a.id,name:a.name,parent_group:a.parent_group??null,children:[]})),b.forEach(a=>{const r=t.get(a.id);a.parent_group&&t.has(a.parent_group)?t.get(a.parent_group).children.push(r):s.push(r)}),s},[b,Me]),st=n.useMemo(()=>{const t=new Map;return F.forEach(s=>{(s.groups||[]).forEach(r=>{const w=t.get(r)||[];w.push(s),t.set(r,w)})}),t},[F]),ie=n.useMemo(()=>F.filter(t=>!t.groups||t.groups.length===0),[F]),Ae=n.useRef("");n.useEffect(()=>{if(!!!(j.name&&j.name.trim()))return;const s=W,a=`${j.name}`;!y&&s===0&&Ae.current!==a&&(Ae.current=a,P.info("No contacts match your filter. Adjust or clear filters to see results."))},[j.name,W,y]);const De=({node:t,depth:s,contactsByGroup:a,onView:r,onEdit:w,onDelete:S})=>{const[G,z]=ft.useState(!0),L=t.children||[],le=a.get(t.id)||[],oe=L.length>0,ce=le.length>0;return e.jsxs("li",{className:"text-sm",style:{paddingLeft:s*12},children:[e.jsx("div",{className:"flex items-center justify-between py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[oe||ce?e.jsx("button",{type:"button","aria-label":G?"Collapse":"Expand",className:"text-muted-foreground hover:text-foreground transition-colors",onClick:()=>z(E=>!E),children:G?e.jsx(St,{className:"size-4"}):e.jsx(gt,{className:"size-4"})}):e.jsx("span",{className:"inline-block w-4"}),e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx("span",{children:t.name}),(ce||oe)&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",le.length,oe?`, ${L.length} sub`:"",")"]})]})]})}),G&&e.jsxs("div",{className:"ml-3",children:[ce&&e.jsx("ul",{className:"space-y-1",children:le.map(E=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:E.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>r(E.id),children:"View"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>w(E),children:"Edit"}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>S(E.id),disabled:Q,children:"Delete"})]})]},E.id))}),L.length>0&&e.jsx("ul",{className:"border-l pl-3 mt-1",children:L.map(E=>e.jsx(De,{node:E,depth:s+1,contactsByGroup:a,onView:r,onEdit:w,onDelete:S},E.id))})]})]})},{title:at}=kt("/contact","Contacts • PayFirst");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:at.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage your contacts and assign them to groups."})]}),Ie&&e.jsxs("div",{className:"max-w-xl rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700 flex items-center justify-between gap-3",children:[e.jsx("span",{children:Ie}),e.jsx(l,{type:"button",size:"sm",variant:"outline",onClick:()=>B(),children:"Retry"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(l,{size:"sm",variant:"outline",onClick:()=>U(!0),children:"Import CSV"})}),e.jsx(l,{size:"sm",onClick:()=>{V(!0),J(null)},children:"New Contact"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"font-medium",children:"All contacts"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[!h&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-muted-foreground",htmlFor:"contact-page-size",children:"Rows per page"}),e.jsxs("select",{id:"contact-page-size",className:"h-8 rounded-md border bg-background px-2 text-sm",value:x,onChange:t=>{c(Number(t.target.value)),u(1)},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]}),e.jsxs(l,{variant:h?"default":"outline",size:"sm",className:"gap-1",onClick:()=>{v(!0),u(1)},children:[e.jsx(yt,{className:"size-4"})," Tree"]}),e.jsxs(l,{variant:h?"outline":"default",size:"sm",className:"gap-1",onClick:()=>v(!1),children:[e.jsx(wt,{className:"size-4"})," List"]})]})]}),_e&&e.jsxs("div",{className:"rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700 flex items-center justify-between gap-3",children:[e.jsx("span",{children:_e}),e.jsx(l,{type:"button",size:"sm",variant:"outline",onClick:()=>_(t=>t+1),children:"Retry"})]}),h?e.jsxs("div",{className:"rounded-md border divide-y",children:[e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Y,{value:m,onChange:t=>k(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),f({name:m.trim().toLowerCase()}),u(1))},placeholder:"Filter name…",className:"pl-8 h-8 w-64"}),e.jsx(Le,{className:"absolute left-2 top-2 size-4 text-muted-foreground"})]}),e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2",disabled:M,onClick:()=>{f({name:m.trim().toLowerCase()}),u(1)},children:"Apply"})]}),e.jsxs("ul",{className:"p-2",children:[Re.map(t=>e.jsx(De,{node:t,depth:0,contactsByGroup:st,onView:s=>q(s),onEdit:s=>{D(s.id),X(s.name),Z(s.groups||[])},onDelete:s=>T(s)},t.id)),ie.length>0&&e.jsxs("li",{className:"pt-2",children:[e.jsx("div",{className:"font-medium text-sm mb-1",children:"Ungrouped"}),e.jsx("ul",{className:"ml-3 space-y-1",children:ie.map(t=>e.jsxs("li",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>q(t.id),children:"View"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{D(t.id),X(t.name),Z(t.groups||[])},children:"Edit"}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>T(t.id),disabled:Q,children:"Delete"})]})]},t.id))})]}),Re.length===0&&ie.length===0&&e.jsx("li",{className:"text-sm text-muted-foreground",children:"No contacts found"})]})]}):e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(jt,{children:[e.jsxs(bt,{children:[e.jsxs(K,{children:[e.jsx(de,{className:"cursor-pointer select-none",onClick:()=>d(t=>t==="name"?"-name":"name"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Name ",i.includes("name")&&(i.startsWith("-")?e.jsx(vt,{className:"size-4"}):e.jsx(Nt,{className:"size-4"}))]})}),e.jsx(de,{children:"Groups"}),e.jsx(de,{className:"w-[1%] whitespace-nowrap text-right pr-3",children:"Actions"})]}),e.jsxs(K,{children:[e.jsx(I,{children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{value:m,onChange:t=>{k(t.target.value)},onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),f({name:m.trim().toLowerCase()}),u(1))},placeholder:"Filter name…",className:"pl-8 h-8"}),e.jsx(Le,{className:"absolute left-2 top-2 size-4 text-muted-foreground"})]})}),e.jsx(I,{}),e.jsx(I,{className:"text-right pr-3",children:e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2",disabled:M,onClick:()=>{f({name:m.trim().toLowerCase()}),u(1)},children:"Apply"})})]})]}),e.jsx(Ct,{children:y?Array.from({length:5}).map((t,s)=>e.jsxs(K,{children:[e.jsx(I,{children:e.jsx(H,{className:"h-4 w-40"})}),e.jsx(I,{children:e.jsx(H,{className:"h-4 w-24"})}),e.jsx(I,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(H,{className:"h-8 w-16"}),e.jsx(H,{className:"h-8 w-16"}),e.jsx(H,{className:"h-8 w-16"})]})})]},s)):F.length?F.map(t=>e.jsxs(K,{children:[e.jsx(I,{children:e.jsx("div",{className:"font-medium",children:t.name})}),e.jsx(I,{className:"text-muted-foreground",children:(()=>{const s=new Map;b.forEach(S=>s.set(S.id,S));const a=S=>{const G=[];let z=s.get(S);const L=new Set;for(;z&&!L.has(z.id)&&(L.add(z.id),G.unshift(z.name),z.parent_group&&s.has(z.parent_group));)z=s.get(z.parent_group);return G.join(" > ")},r=t.groups||[];if(!r.length)return"—";const w=r.map(a).filter(Boolean);return w.length?w.join(", "):r.map(S=>s.get(S)?.name||String(S)).join(", ")})()}),e.jsx(I,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>q(t.id),children:"View"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{D(t.id),X(t.name),Z(t.groups||[])},children:"Edit"}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>T(t.id),disabled:Q,children:"Delete"})]})})]},t.id)):e.jsx(K,{children:e.jsx(I,{colSpan:3,className:"text-sm text-muted-foreground",children:"No contacts found"})})})]})}),(()=>{const t=Math.max(1,Math.ceil(W/x));return!h&&W>0?e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>u(s=>Math.max(1,s-1)),disabled:p===1,children:"Prev"}),e.jsxs("span",{className:"text-xs",children:["Page ",p," of ",t]}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>u(s=>Math.min(t,s+1)),disabled:p>=t,children:"Next"})]}):null})()]}),Je&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>V(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"new-contact-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"new-contact-title",className:"font-semibold",children:"New contact"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>V(!1),children:"Close"})]}),e.jsxs("form",{onSubmit:async t=>{await tt(t)&&V(!1)},className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{htmlFor:"name",children:"Name"}),e.jsx(Y,{id:"name",value:re,onChange:t=>pe(t.target.value),placeholder:"Jane Doe"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{htmlFor:"picture",children:"Picture"}),e.jsx("input",{id:"picture",type:"file",accept:"image/*",onChange:t=>je(t.target.files?.[0]||null),className:"h-9 rounded-md border bg-background px-2 text-sm"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Optional. JPG/PNG recommended."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{children:"Groups"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:g?e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading groups…"}):b.length?b.map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Te,{checked:xe.includes(t.id),onCheckedChange:s=>et(t.id,!!s)}),e.jsx("span",{children:t.name})]},t.id)):e.jsx("span",{className:"text-sm text-muted-foreground",children:"No groups yet"})})]}),fe&&e.jsx("div",{className:"text-sm text-red-600",children:fe}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>V(!1),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:$,children:"Create"})]})]})]})}),be!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>q(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"view-contact-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"view-contact-title",className:"font-semibold",children:"Contact details"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>q(null),children:"Close"})]}),(()=>{const t=F.find(a=>a.id===be);if(!t)return e.jsx("div",{className:"text-sm",children:"Not found"});const s=(t.groups||[]).map(a=>b.find(r=>r.id===a)?.name||String(a));return e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Name:"})," ",t.name]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Groups:"})," ",s.length?s.join(", "):"—"]})]})})()]})}),ve!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>D(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"edit-contact-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"edit-contact-title",className:"font-semibold",children:"Edit contact"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>D(null),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async t=>{t.preventDefault();try{const s=ve,a=new FormData;a.append("name",Ne.trim()),Ce.forEach(w=>a.append("groups",String(w))),ye&&a.append("picture",ye);const r=await ae({id:s,changes:a}).unwrap();P.success(ee(r,"Contact updated")),D(null)}catch(s){P.error(te(s))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{htmlFor:"edit-name",children:"Name"}),e.jsx(Y,{id:"edit-name",value:Ne,onChange:t=>X(t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{htmlFor:"edit-picture",children:"Picture"}),e.jsx("input",{id:"edit-picture",type:"file",accept:"image/*",onChange:t=>{const s=t.target.files?.[0]||null;Xe(s)},className:"h-9 rounded-md border bg-background px-2 text-sm"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Optional. Upload to replace existing picture."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{children:"Groups"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:b.map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Te,{checked:Ce.includes(t.id),onCheckedChange:s=>Z(a=>s?Array.from(new Set([...a,t.id])):a.filter(r=>r!==t.id))}),e.jsx("span",{children:t.name})]},t.id))})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>D(null),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:ne,children:"Save"})]})]})]})}),ke!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>T(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"delete-contact-title",className:"bg-background rounded-md p-4 w-[420px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{id:"delete-contact-title",className:"font-semibold mb-2",children:"Delete contact"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>T(null),children:"Cancel"}),e.jsx(l,{variant:"destructive",disabled:Q,onClick:async()=>{try{const t=await Qe(ke).unwrap();P.success(ee(t,"Contact deleted"))}catch(t){P.error(te(t))}finally{T(null)}},children:"Delete"})]})]})}),Ze&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>U(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"import-contacts-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"import-contacts-title",className:"font-semibold",children:"Import contacts from CSV"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>U(!1),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async t=>{if(t.preventDefault(),!we){P.error("Please choose a CSV file");return}try{const s=await Ye({file:we,_type:ze}).unwrap();P.success(ee(s,"Import started")),U(!1),Se(null),_(a=>a+1)}catch(s){P.error(te(s))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{htmlFor:"import-file",children:"CSV file"}),e.jsx("input",{id:"import-file",type:"file",accept:".csv,text/csv",onChange:t=>Se(t.target.files?.[0]||null),className:"h-9 rounded-md border bg-background px-2 text-sm"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Upload a CSV exported from Google Contacts."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{htmlFor:"import-type",children:"Type"}),e.jsx("select",{id:"import-type",className:"h-9 rounded-md border bg-background px-2 text-sm",value:ze,onChange:t=>We(t.target.value),children:e.jsx("option",{value:"google",children:"Google"})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>U(!1),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:Ee,children:Ee?"Importing…":"Import"})]})]})]})})]})};export{Ot as default};
