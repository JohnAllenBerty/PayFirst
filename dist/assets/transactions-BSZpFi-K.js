import{r as a,w as ft,E as bt,F as vt,G as yt,H as Nt,J as Ct,K as wt,M as St,N as kt,y as d,j as e,B as c,I as u,L as o,i as A,k as b}from"./index-BbQ3UlKF.js";import{u as Pt}from"./useMeta-Do0ZXGYI.js";import{S as x}from"./skeleton-mX7TdaWE.js";import{T as _t,b as At,c as S,d as h,A as M,a as T,e as l,f as Mt}from"./table-DQfnjL0Y.js";import{S as Tt}from"./search-B37cGDDG.js";const Et=()=>{const{title:Ye}=Pt("/transactions","Transactions • PayFirst"),[p,v]=a.useState(1),[j,et]=a.useState(10),[m,k]=a.useState("label"),[oe,ue]=a.useState(0),[z,tt]=a.useState(""),[D,st]=a.useState(""),[L,at]=a.useState(""),[n,me]=a.useState({}),{data:xe,isLoading:nt}=ft({page_size:1e3}),{data:he,isLoading:rt}=bt({page_size:1e3}),[pe,{isLoading:P}]=vt(),{data:je,isLoading:lt}=yt({page_size:1e3}),[it,{isLoading:ct}]=Nt(),y=a.useMemo(()=>{const t=he;if(!t)return[];if(t.status===!1)return[];if(t.status===!0){const r=t.data;return Array.isArray(r)?r:r.results??[]}const s=t;return Array.isArray(s.results)?s.results:[]},[he]),F=a.useMemo(()=>{const t=je;if(!t)return[];if(t.status===!1)return[];if(t.status===!0){const r=t.data;return Array.isArray(r)?r:r.results??[]}const s=t;return Array.isArray(s.results)?s.results:[]},[je]),g=a.useMemo(()=>{const t=xe;if(!t)return[];if(t.status===!1)return[];if(t.status===!0){const r=t.data;return Array.isArray(r)?r:r.results??[]}const s=t;return Array.isArray(s.results)?s.results:[]},[xe]),ge=a.useMemo(()=>{const t=[];if(n.label&&t.push(n.label),typeof n.contact=="number"){const s=g.find(i=>i.id===n.contact);s?.name&&t.push(s.name)}return t.join(" ").trim()||void 0},[n,g]),dt=a.useMemo(()=>{const t={ordering:m,refresh:oe,search:ge};return n._type||(t.page=p,t.page_size=j),t},[m,oe,ge,n._type,p,j]),{data:R,isLoading:E,isFetching:ot}=Ct(dt),[ut,{isLoading:mt}]=wt(),[xt,{isLoading:ht}]=St(),[pt,{isLoading:fe}]=kt(),Q=a.useMemo(()=>{const t=R;if(!t)return{items:[],total:0};if(t.status===!1)return{items:[],total:0};if(t.status===!0){const r=t.data;return Array.isArray(r)?{items:r,total:r.length}:{items:r.results??[],total:r.count??(r.results?r.results.length:0)}}const s=t;return Array.isArray(s.results)?{items:s.results,total:s.count}:{items:[],total:0}},[R]),I=a.useMemo(()=>{let t=Q.items;return n._type&&(t=t.filter(s=>s._type===n._type)),typeof n.contact=="number"&&(t=t.filter(s=>s.contact===n.contact)),n.label&&(t=t.filter(s=>s.label.toLowerCase().includes(n.label.toLowerCase()))),t},[Q.items,n]),be=n._type?I.length:Q.total,ve=(()=>{const t=R;return t&&t.status===!1?String(t.error??"Server error"):null})(),[O,ye]=a.useState(""),[$,Ne]=a.useState(""),[Ce,we]=a.useState("credit"),[Se,ke]=a.useState(""),[Pe,_e]=a.useState(""),[Ae,Me]=a.useState(""),[Te,f]=a.useState(null),[jt,N]=a.useState(!1),[q,B]=a.useState(""),[U,W]=a.useState(""),[ze,De]=a.useState(""),[H,J]=a.useState(!1),[K,V]=a.useState(""),[Z,G]=a.useState(!1),[Le,X]=a.useState(!1),C=I,[Fe,Y]=a.useState(null),[Re,w]=a.useState(null),[Ee,Qe]=a.useState(""),[Ie,Oe]=a.useState("credit"),[$e,qe]=a.useState(""),[Be,Ue]=a.useState(""),[We,He]=a.useState(""),[Je,_]=a.useState(null),gt=async t=>{if(t.preventDefault(),f(null),!O.trim())return f("Label is required"),!1;if($==="")return f("Contact is required"),!1;const s=parseFloat(Se);if(!isFinite(s)||s<=0)return f("Amount must be > 0"),!1;try{const i=await ut({label:O.trim(),contact:Number($),_type:Ce,amount:s,description:Pe.trim(),return_date:Ae||null,date:new Date().toISOString().slice(0,10),payment_method:q===""?null:Number(q),payment_source:U===""?null:Number(U),transaction_reference:ze.trim()||null}).unwrap();return ye(""),Ne(""),we("credit"),ke(""),_e(""),Me(""),B(""),W(""),De(""),d.success(A(i,"Transaction created")),ue(r=>r+1),!0}catch(i){const r=b(i);return f(r),d.error(r),!1}},[ee,te]=a.useState(""),[se,Ke]=a.useState(""),[Ve,Ze]=a.useState(""),[ae,ne]=a.useState(!1),[re,le]=a.useState(""),[ie,ce]=a.useState(!1),[Ge,de]=a.useState(!1),Xe=a.useRef("");return a.useEffect(()=>{if(E||!!!(n.label||n._type||typeof n.contact=="number"))return;const s=`${n.label||""}|${n._type||""}|${n.contact||""}`;C.length===0&&Xe.current!==s&&(Xe.current=s,d.info("No transactions match your filters. Adjust or clear filters to see results."))},[E,C.length,n]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:Ye.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Record credits and debits for your contacts."})]}),ve&&e.jsxs("div",{className:"max-w-xl rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700 flex items-center justify-between gap-3",children:[e.jsx("span",{children:ve}),e.jsx(c,{type:"button",size:"sm",variant:"outline",onClick:()=>ue(t=>t+1),children:"Retry"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{}),e.jsx(c,{size:"sm",onClick:()=>{N(!0),f(null)},children:"New Transaction"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"font-medium",children:"All transactions"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-muted-foreground",htmlFor:"tx-page-size",children:"Rows per page"}),e.jsxs("select",{id:"tx-page-size",className:"h-8 rounded-md border bg-background px-2 text-sm",value:j,onChange:t=>{et(Number(t.target.value)),v(1)},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(_t,{children:[e.jsxs(At,{children:[e.jsxs(S,{children:[e.jsx(h,{className:"cursor-pointer select-none","aria-label":"Sort by label",onClick:()=>k(t=>t==="label"?"-label":"label"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Label ",m.includes("label")&&(m.startsWith("-")?e.jsx(M,{className:"size-4"}):e.jsx(T,{className:"size-4"}))]})}),e.jsx(h,{children:"Type"}),e.jsx(h,{className:"cursor-pointer select-none","aria-label":"Sort by amount",onClick:()=>k(t=>t==="amount"?"-amount":"amount"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Amount ",m.includes("amount")&&(m.startsWith("-")?e.jsx(M,{className:"size-4"}):e.jsx(T,{className:"size-4"}))]})}),e.jsx(h,{children:"Pending"}),e.jsx(h,{children:"Contact"}),e.jsx(h,{className:"cursor-pointer select-none","aria-label":"Sort by date",onClick:()=>k(t=>t==="date"?"-date":"date"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Date ",m.includes("date")&&(m.startsWith("-")?e.jsx(M,{className:"size-4"}):e.jsx(T,{className:"size-4"}))]})}),e.jsx(h,{className:"cursor-pointer select-none","aria-label":"Sort by return date",onClick:()=>k(t=>t==="return_date"?"-return_date":"return_date"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Return date ",m.includes("return_date")&&(m.startsWith("-")?e.jsx(M,{className:"size-4"}):e.jsx(T,{className:"size-4"}))]})}),e.jsx(h,{className:"w-[1%] whitespace-nowrap text-right pr-3",children:"Actions"})]}),e.jsxs(S,{children:[e.jsx(l,{children:e.jsxs("div",{className:"relative",children:[e.jsx(u,{value:z,onChange:t=>tt(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),me({...n,label:z.trim()||void 0}),v(1))},placeholder:"Filter label…",className:"pl-8 h-8"}),e.jsx(Tt,{className:"absolute left-2 top-2 size-4 text-muted-foreground"})]})}),e.jsx(l,{children:e.jsxs("select",{className:"h-8 rounded-md border bg-background px-2 text-sm",value:D,onChange:t=>st(t.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"credit",children:"Credit"}),e.jsx("option",{value:"debit",children:"Debit"})]})}),e.jsx(l,{}),e.jsx(l,{}),e.jsx(l,{children:e.jsxs("select",{className:"h-8 rounded-md border bg-background px-2 text-sm",value:L,onChange:t=>at(t.target.value?Number(t.target.value):""),children:[e.jsx("option",{value:"",children:"All contacts"}),g.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),e.jsx(l,{}),e.jsx(l,{className:"text-right pr-3",children:e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2",disabled:ot,onClick:()=>{const t={},s=z.trim();s&&(t.label=s),D&&(t._type=D),typeof L=="number"&&(t.contact=L),me(t),v(1)},children:"Apply"})})]})]}),e.jsx(Mt,{children:E?Array.from({length:5}).map((t,s)=>e.jsxs(S,{children:[e.jsx(l,{children:e.jsx(x,{className:"h-4 w-40"})}),e.jsx(l,{children:e.jsx(x,{className:"h-4 w-16"})}),e.jsx(l,{children:e.jsx(x,{className:"h-4 w-20"})}),e.jsx(l,{children:e.jsx(x,{className:"h-4 w-24"})}),e.jsx(l,{children:e.jsx(x,{className:"h-4 w-40"})}),e.jsx(l,{children:e.jsx(x,{className:"h-4 w-24"})}),e.jsx(l,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(x,{className:"h-8 w-16"}),e.jsx(x,{className:"h-8 w-16"}),e.jsx(x,{className:"h-8 w-16"})]})})]},s)):C.length?(n._type?C.slice((p-1)*j,p*j):C).map(t=>e.jsxs(S,{children:[e.jsx(l,{className:"font-medium",title:t.description?`${t.label} — ${t.description}`:t.label,children:t.label}),e.jsx(l,{className:"uppercase",children:t._type}),e.jsx(l,{children:t.amount}),e.jsx(l,{className:"text-muted-foreground",children:t.pending_amount}),e.jsx(l,{children:g.find(s=>s.id===t.contact)?.name||t.contact}),e.jsx(l,{children:t.date}),e.jsx(l,{children:t.return_date||"—"}),e.jsx(l,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>Y(t.id),children:"View"}),e.jsx(c,{size:"sm",variant:"outline",onClick:()=>{w(t.id),Qe(t.label),Oe(t._type),qe(String(t.amount)),Ue(t.description||""),He(t.return_date||""),te(typeof t.payment_method=="number"?t.payment_method:""),Ke(typeof t.payment_source=="number"?t.payment_source:""),Ze(t.transaction_reference||"")},children:"Edit"}),e.jsx(c,{size:"sm",variant:"destructive",onClick:()=>_(t.id),disabled:fe,children:"Delete"})]})})]},t.id)):e.jsx(S,{children:e.jsx(l,{colSpan:7,className:"text-sm text-muted-foreground",children:"No transactions found"})})})]})}),(()=>{const t=Math.max(1,Math.ceil(be/j));return be>0?e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>v(s=>Math.max(1,s-1)),disabled:p===1,children:"Prev"}),e.jsxs("span",{className:"text-xs",children:["Page ",p," of ",t]}),e.jsx(c,{size:"sm",variant:"outline",onClick:()=>v(s=>Math.min(t,s+1)),disabled:p>=t,children:"Next"})]}):null})()]}),jt&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>N(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"new-transaction-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"new-transaction-title",className:"font-semibold",children:"New transaction"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>N(!1),children:"Close"})]}),e.jsxs("form",{onSubmit:async t=>{await gt(t)&&N(!1)},className:"grid gap-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"label",children:"Label"}),e.jsx(u,{id:"label",value:O,onChange:t=>ye(t.target.value),placeholder:"Loan to John"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"contact",children:"Contact"}),e.jsxs("select",{id:"contact",className:"h-9 rounded-md border bg-background px-3 text-sm",value:$,onChange:t=>Ne(t.target.value?Number(t.target.value):""),children:[e.jsx("option",{value:"",disabled:!0,children:nt?"Loading…":"Select a contact"}),g.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"type",children:"Type"}),e.jsxs("select",{id:"type",className:"h-9 rounded-md border bg-background px-3 text-sm",value:Ce,onChange:t=>we(t.target.value),children:[e.jsx("option",{value:"credit",children:"Credit"}),e.jsx("option",{value:"debit",children:"Debit"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"amount",children:"Amount"}),e.jsx(u,{id:"amount",type:"number",min:"0",step:"0.01",value:Se,onChange:t=>ke(t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"description",children:"Description"}),e.jsx(u,{id:"description",value:Pe,onChange:t=>_e(t.target.value),placeholder:"Optional description"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"returnDate",children:"Return date (optional)"}),e.jsx(u,{id:"returnDate",type:"date",value:Ae,onChange:t=>Me(t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"payment-method",children:"Payment method (optional)"}),e.jsxs("select",{id:"payment-method",className:"h-9 rounded-md border bg-background px-3 text-sm",value:q,onChange:t=>B(t.target.value?Number(t.target.value):""),children:[e.jsx("option",{value:"",children:rt?"Loading…":"None"}),y.map(t=>e.jsxs("option",{value:t.id,children:[t.label,t.is_default?" (default)":""]},t.id))]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>J(t=>!t),children:H?"Cancel":"Add new"}),H&&P&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Saving…"})]}),H&&e.jsxs("div",{className:"mt-2 border rounded-md p-2 space-y-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(o,{htmlFor:"new-pm-label",className:"text-xs",children:"New method label"}),e.jsx(u,{id:"new-pm-label",value:K,onChange:t=>V(t.target.value),placeholder:"e.g. Cash",className:"h-8"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:Z,onChange:t=>G(t.target.checked)})," Default"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:Le,onChange:t=>X(t.target.checked)})," Common"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(c,{type:"button",size:"sm",variant:"outline",className:"h-7 px-3",onClick:()=>{J(!1),V(""),G(!1),X(!1)},children:"Cancel"}),e.jsx(c,{type:"button",size:"sm",className:"h-7 px-3",disabled:P,onClick:async()=>{if(!K.trim()){d.error("Label required");return}if(Z&&y.some(t=>t.is_default)){d.error("Only one default method allowed");return}try{const t=await pe({label:K.trim(),is_default:Z,is_common:Le}).unwrap();if(t?.status){const s=t.data;B(s.id),d.success(A(t,"Added"))}else d.success("Added");J(!1),V(""),G(!1),X(!1)}catch(t){d.error(b(t))}},children:"Save"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"payment-source",children:"Payment source (optional)"}),e.jsxs("select",{id:"payment-source",className:"h-9 rounded-md border bg-background px-3 text-sm",value:U,onChange:t=>W(t.target.value?Number(t.target.value):""),children:[e.jsx("option",{value:"",children:lt?"Loading…":"None"}),F.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:async()=>{const t=prompt("New payment source label?")?.trim();if(t)try{const s=await it({label:t}).unwrap();if(s?.status){const i=s.data;W(i.id),d.success(A(s,"Added"))}else d.success("Added")}catch(s){d.error(b(s))}},children:"Add new"}),ct&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Saving…"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"tx-ref",children:"Reference (optional)"}),e.jsx(u,{id:"tx-ref",value:ze,onChange:t=>De(t.target.value),placeholder:"e.g., UTR/Ref no."})]}),Te&&e.jsx("div",{className:"text-sm text-red-600",children:Te}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(c,{type:"submit",disabled:mt,children:"Create"})]})]})]})}),Fe!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>Y(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"view-transaction-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"view-transaction-title",className:"font-semibold",children:"Transaction details"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>Y(null),children:"Close"})]}),(()=>{const t=I.find(i=>i.id===Fe);if(!t)return e.jsx("div",{className:"text-sm",children:"Not found"});const s=g.find(i=>i.id===t.contact)?.name||t.contact;return e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Label:"})," ",t.label]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Contact:"})," ",String(s)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"})," ",t._type]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"})," ",t.amount]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Pending:"})," ",t.pending_amount]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Date:"})," ",t.date]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Return date:"})," ",t.return_date||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Description:"})," ",t.description||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment method:"})," ",y.find(i=>i.id===(t.payment_method??-1))?.label||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment source:"})," ",F.find(i=>i.id===(t.payment_source??-1))?.label||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Reference:"})," ",t.transaction_reference||"—"]})]})})()]})}),Re!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>w(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"edit-transaction-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"edit-transaction-title",className:"font-semibold",children:"Edit transaction"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>w(null),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async t=>{t.preventDefault();try{const s=Re,i=parseFloat($e);await xt({id:s,changes:{label:Ee.trim(),_type:Ie,amount:i,description:Be.trim(),return_date:We||null,payment_method:ee===""?null:Number(ee),payment_source:se===""?null:Number(se),transaction_reference:Ve.trim()||null}}).unwrap(),d.success("Transaction updated"),w(null)}catch(s){d.error(b(s))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-label",children:"Label"}),e.jsx(u,{id:"edit-label",value:Ee,onChange:t=>Qe(t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-type",children:"Type"}),e.jsxs("select",{id:"edit-type",className:"h-9 rounded-md border bg-background px-3 text-sm",value:Ie,onChange:t=>Oe(t.target.value),children:[e.jsx("option",{value:"credit",children:"Credit"}),e.jsx("option",{value:"debit",children:"Debit"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-amount",children:"Amount"}),e.jsx(u,{id:"edit-amount",type:"number",min:"0",step:"0.01",value:$e,onChange:t=>qe(t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-description",children:"Description"}),e.jsx(u,{id:"edit-description",value:Be,onChange:t=>Ue(t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-return-date",children:"Return date"}),e.jsx(u,{id:"edit-return-date",type:"date",value:We,onChange:t=>He(t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-payment-method",children:"Payment method (optional)"}),e.jsxs("select",{id:"edit-payment-method",className:"h-9 rounded-md border bg-background px-3 text-sm",value:ee,onChange:t=>te(t.target.value?Number(t.target.value):""),children:[e.jsx("option",{value:"",children:"None"}),y.map(t=>e.jsxs("option",{value:t.id,children:[t.label,t.is_default?" (default)":""]},t.id))]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(c,{type:"button",variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>ne(t=>!t),children:ae?"Cancel":"Add new"}),ae&&P&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Saving…"})]}),ae&&e.jsxs("div",{className:"mt-2 border rounded-md p-2 space-y-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(o,{htmlFor:"new-pm-label-edit",className:"text-xs",children:"New method label"}),e.jsx(u,{id:"new-pm-label-edit",value:re,onChange:t=>le(t.target.value),placeholder:"e.g. Cash",className:"h-8"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:ie,onChange:t=>ce(t.target.checked)})," Default"]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:Ge,onChange:t=>de(t.target.checked)})," Common"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(c,{type:"button",size:"sm",variant:"outline",className:"h-7 px-3",onClick:()=>{ne(!1),le(""),ce(!1),de(!1)},children:"Cancel"}),e.jsx(c,{type:"button",size:"sm",className:"h-7 px-3",disabled:P,onClick:async()=>{if(!re.trim()){d.error("Label required");return}if(ie&&y.some(t=>t.is_default)){d.error("Only one default method allowed");return}try{const t=await pe({label:re.trim(),is_default:ie,is_common:Ge}).unwrap();if(t?.status){const s=t.data;te(s.id),d.success(A(t,"Added"))}else d.success("Added");ne(!1),le(""),ce(!1),de(!1)}catch(t){d.error(b(t))}},children:"Save"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-payment-source",children:"Payment source (optional)"}),e.jsxs("select",{id:"edit-payment-source",className:"h-9 rounded-md border bg-background px-3 text-sm",value:se,onChange:t=>Ke(t.target.value?Number(t.target.value):""),children:[e.jsx("option",{value:"",children:"None"}),F.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-tx-ref",children:"Reference (optional)"}),e.jsx(u,{id:"edit-tx-ref",value:Ve,onChange:t=>Ze(t.target.value),placeholder:"e.g., UTR/Ref no."})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>w(null),children:"Cancel"}),e.jsx(c,{type:"submit",disabled:ht,children:"Save"})]})]})]})}),Je!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>_(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"delete-transaction-title",className:"bg-background rounded-md p-4 w-[420px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{id:"delete-transaction-title",className:"font-semibold mb-2",children:"Delete transaction"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>_(null),children:"Cancel"}),e.jsx(c,{variant:"destructive",disabled:fe,onClick:async()=>{try{await pt(Je).unwrap(),d.success("Transaction deleted")}catch(t){d.error(b(t))}finally{_(null)}},children:"Delete"})]})]})})]})};export{Et as default};
