import{r as a,E as de,F as oe,U as me,V as ue,y as n,j as e,B as i,I as S,i as P,k as M,L as Z}from"./index-BIe6Yvnn.js";import{T as he,b as xe,c as u,d as f,A as pe,a as je,e as l,f as fe}from"./table-DmahFypA.js";import{S as h}from"./skeleton-C8a3ZLwH.js";import{u as ge}from"./useMeta-BAb4LK-K.js";import{P as be}from"./plus-CbULjFAS.js";const we=()=>{const{title:$}=ge("/payment-methods","Payment Methods • PayFirst"),[x,c]=a.useState(1),[g,q]=a.useState(10),[b,K]=a.useState("label"),[V,W]=a.useState(0),[y,G]=a.useState(""),[N,A]=a.useState({}),[J,X]=a.useState(""),{data:D,isLoading:L,isFetching:ee}=de({page:x,page_size:g,ordering:b,refresh:V,search:N.label}),[se,{isLoading:te}]=oe(),[ae,{isLoading:le}]=me(),[ie,{isLoading:ne}]=ue(),z=a.useMemo(()=>{const s=D;if(!s)return{items:[],total:0};if(s.status===!0){const r=s.data;if(Array.isArray(r))return{items:r,total:r.length};const j=r;return Array.isArray(j.results)?{items:j.results,total:j.count??j.results.length}:{items:[],total:0}}if(s.status===!1)return{items:[],total:0};const t=s;return Array.isArray(t.results)?{items:t.results,total:t.count??t.results.length}:{items:[],total:0}},[D]),d=z.items,E=z.total,re=!!N.label;if(!L&&re&&d.length===0){const s=`${N.label||""}`;s!==J&&(X(s),n.info("No payment methods match your filter. Adjust or clear filters to see results."))}const[ce,o]=a.useState(!1),[v,_]=a.useState(""),[C,F]=a.useState(!1),[T,I]=a.useState(!1),[U,k]=a.useState(null),[R,m]=a.useState(null),[B,O]=a.useState(""),[w,Q]=a.useState(!1),[H,Y]=a.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:$.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage methods you use for transactions and repayments."})]}),e.jsxs(i,{size:"sm",onClick:()=>o(!0),children:[e.jsx(be,{className:"mr-1 h-4 w-4"})," Add Method"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"font-medium",children:"All methods"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-muted-foreground",htmlFor:"pm-page-size",children:"Rows per page"}),e.jsxs("select",{id:"pm-page-size",className:"h-8 rounded-md border bg-background px-2 text-sm",value:g,onChange:s=>{q(Number(s.target.value)),c(1)},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(he,{children:[e.jsxs(xe,{children:[e.jsxs(u,{children:[e.jsx(f,{className:"cursor-pointer select-none",onClick:()=>K(s=>s==="label"?"-label":"label"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Label ",b.includes("label")&&(b.startsWith("-")?e.jsx(pe,{className:"size-4"}):e.jsx(je,{className:"size-4"}))]})}),e.jsx(f,{children:"Default"}),e.jsx(f,{children:"Common"}),e.jsx(f,{className:"w-[1%] whitespace-nowrap text-right pr-3",children:"Actions"})]}),e.jsxs(u,{children:[e.jsx(l,{children:e.jsx(S,{value:y,onChange:s=>G(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),A({label:y.trim()||void 0}),c(1))},placeholder:"Filter label…",className:"h-8"})}),e.jsx(l,{}),e.jsx(l,{}),e.jsx(l,{className:"text-right pr-3",children:e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2",disabled:ee,onClick:()=>{A({label:y.trim()||void 0}),c(1)},children:"Apply"})})]})]}),e.jsx(fe,{children:L?Array.from({length:5}).map((s,t)=>e.jsxs(u,{children:[e.jsx(l,{children:e.jsx(h,{className:"h-4 w-40"})}),e.jsx(l,{children:e.jsx(h,{className:"h-4 w-16"})}),e.jsx(l,{children:e.jsx(h,{className:"h-4 w-16"})}),e.jsx(l,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(h,{className:"h-8 w-16"}),e.jsx(h,{className:"h-8 w-16"})]})})]},t)):d.length?d.map(s=>e.jsxs(u,{children:[e.jsx(l,{className:"font-medium",children:s.label}),e.jsx(l,{children:s.is_default?"Yes":"No"}),e.jsx(l,{children:s.is_common?"Yes":"No"}),e.jsx(l,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>{m(s.id),O(s.label),Q(!!s.is_default),Y(!!s.is_common)},children:"Edit"}),e.jsx(i,{size:"sm",variant:"destructive",disabled:ne,onClick:async()=>{try{const t=await ie(s.id).unwrap();n.success(P(t,"Deleted"))}catch(t){n.error(M(t))}},children:"Delete"})]})})]},s.id)):e.jsx(u,{children:e.jsx(l,{colSpan:4,className:"text-sm text-muted-foreground",children:"No payment methods found"})})})]})}),(()=>{const s=Math.max(1,Math.ceil(E/g));return E>0?e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>c(t=>Math.max(1,t-1)),disabled:x===1,children:"Prev"}),e.jsxs("span",{className:"text-xs",children:["Page ",x," of ",s]}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>c(t=>Math.min(s,t+1)),disabled:x>=s,children:"Next"})]}):null})()]}),ce&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>o(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"add-payment-method-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"add-payment-method-title",className:"font-semibold",children:"Add payment method"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>o(!1),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async s=>{if(s.preventDefault(),k(null),!v.trim()){k("Label is required");return}if(C&&d.some(t=>t.is_default)){k("There is already a default payment method. Unset it before creating a new default.");return}try{const t=await se({label:v.trim(),is_default:C,is_common:T}).unwrap();n.success(P(t,"Payment method added")),_(""),F(!1),I(!1),o(!1),W(p=>p+1)}catch(t){n.error(M(t))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(Z,{htmlFor:"pm-label",children:"Label"}),e.jsx(S,{id:"pm-label",value:v,onChange:s=>_(s.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:s=>F(s.target.checked)})," Default"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:s=>I(s.target.checked)})," Common"]})]}),U&&e.jsx("div",{className:"text-sm text-red-600",children:U}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(i,{type:"submit",disabled:te,children:"Add"})]})]})]})}),R!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>m(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"edit-payment-method-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"edit-payment-method-title",className:"font-semibold",children:"Edit payment method"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>m(null),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async s=>{s.preventDefault();try{const t=R;if(w&&d.some(r=>r.is_default&&r.id!==t)){n.error("Only one default method is allowed. Unset the other default first.");return}const p=await ae({id:t,changes:{label:B.trim(),is_default:w,is_common:H}}).unwrap();n.success(P(p,"Updated")),m(null)}catch(t){n.error(M(t))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(Z,{htmlFor:"edit-pm-label",children:"Label"}),e.jsx(S,{id:"edit-pm-label",value:B,onChange:s=>O(s.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:s=>Q(s.target.checked)})," Default"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:H,onChange:s=>Y(s.target.checked)})," Common"]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>m(null),children:"Cancel"}),e.jsx(i,{type:"submit",disabled:le,children:"Save"})]})]})]})})]})};export{we as default};
