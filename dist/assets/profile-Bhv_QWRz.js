import{j as e}from"./vendor-radix-DPBOYssM.js";import{u as T,P as _,Q as A,k as w,C as L,c as U,e as k,R as M,y as F,j as R,d as I,S as Q,T as q,U as z,L as N,I as v,B as y}from"./index-DwFGw5Mq.js";import{r as n}from"./vendor-redux-Waidrk23.js";import{S as o}from"./skeleton-DwZeeun9.js";import{u as H}from"./useMeta-zUuBD48a.js";import"./vendor-react-gH-7aFTg.js";import"./vendor-router-Du5tOU4S.js";const Z=()=>{const{hasToken:m}=T(),{data:a,isLoading:i,refetch:h}=_(void 0,{skip:!m}),{title:f}=H("/profile","Profile • PayFirst"),[p,{isLoading:g}]=A(),u=n.useMemo(()=>{const s=a;return s&&s.status===!1?w(s):null},[a]),t=a&&typeof a!="string"&&a.status?a.data:null,x=n.useMemo(()=>t?[t.first_name,t.last_name].filter(Boolean).join(" ").trim()||t.user:"Profile",[t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:f.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your account information."})]}),u&&e.jsxs("div",{className:"rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700 flex items-center justify-between gap-3",children:[e.jsx("span",{children:u}),e.jsx("button",{className:"h-8 rounded-md border px-3 text-sm",onClick:()=>h(),children:"Retry"})]}),i?e.jsxs(L,{className:"max-w-xl",children:[e.jsxs(U,{children:[e.jsx(o,{className:"h-6 w-40"}),e.jsx(o,{className:"h-4 w-64"})]}),e.jsxs(k,{className:"space-y-3",children:[e.jsx(o,{className:"h-9 w-full"}),e.jsx(o,{className:"h-9 w-full"}),e.jsx(o,{className:"h-9 w-full"})]}),e.jsx(M,{className:"justify-end",children:e.jsx(o,{className:"h-9 w-20"})})]}):t?e.jsx(J,{user:t.user,first_name:t.first_name,last_name:t.last_name,date_joined:t.date_joined,last_login:t.last_login,displayName:x,onSave:async s=>{try{const l=await p(s).unwrap();F.success(R(l,"Profile updated"))}catch(l){throw F.error(w(l)),l}},saving:g}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No profile data"})]})};function J({user:m,first_name:a,last_name:i,date_joined:h,last_login:f,displayName:p,onSave:g,saving:u}){const[t,x]=n.useState(!1),[s,l]=n.useState(m),[c,b]=n.useState(a),[d,C]=n.useState(i),[S,j]=n.useState(null),E=n.useMemo(()=>[c||a,d||i].filter(Boolean).map(B=>(B||"").trim()[0]).filter(Boolean).join("").slice(0,2)||(s||"U")[0]?.toUpperCase()||"U",[c,d,s,a,i]),D=(s!==m||c!==a||d!==i)&&!!s.trim();return e.jsxs(L,{className:"max-w-xl",children:[e.jsxs(U,{children:[e.jsxs(I,{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"h-8 w-8 rounded-lg",children:e.jsx(q,{className:"rounded-lg",children:E})}),p]}),e.jsx(z,{children:"Update your account information."})]}),e.jsxs(k,{className:"grid gap-4",children:[e.jsxs("div",{className:"text-xs text-muted-foreground grid gap-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Joined:"})," ",new Date(h).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Last login:"})," ",new Date(f).toLocaleString()]})]}),t?e.jsxs("form",{className:"grid gap-3",onSubmit:async r=>{if(r.preventDefault(),j(null),!s.trim()){j("User is required");return}try{await g({user:s.trim(),first_name:c.trim(),last_name:d.trim()}),x(!1)}catch(P){j(w(P))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"u",children:"User"}),e.jsx(v,{id:"u",value:s,onChange:r=>l(r.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"f",children:"First name"}),e.jsx(v,{id:"f",value:c,onChange:r=>b(r.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"l",children:"Last name"}),e.jsx(v,{id:"l",value:d,onChange:r=>C(r.target.value)})]}),S&&e.jsx("div",{className:"text-sm text-red-600",children:S}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>{l(m),b(a),C(i),j(null),x(!1)},children:"Cancel"}),e.jsx(y,{type:"submit",disabled:u||!D,children:u?"Saving…":"Save"})]})]}):e.jsxs("div",{className:"grid gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"User"}),e.jsx("span",{children:s})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"First name"}),e.jsx("span",{children:c||"—"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last name"}),e.jsx("span",{children:d||"—"})]})]})]}),e.jsx(M,{className:"justify-end",children:!t&&e.jsx(y,{size:"sm",onClick:()=>x(!0),children:"Edit"})})]})}export{Z as default};
