import{j as e}from"./vendor-radix-DPBOYssM.js";import{r as a}from"./vendor-redux-Waidrk23.js";import{x as se,z as te,O as ae,P as le,y as r,B as l,I as v,j as N,k as S,L as B}from"./index-DPSrh-G_.js";import{T as re,b as ie,c as d,d as I,A as ne,a as ce,e as i,f as oe}from"./table-DECi1ECM.js";import{S as w}from"./skeleton-ClCK0gDd.js";import{u as de}from"./useMeta-CxZURuxa.js";import{P as me}from"./plus-ysPocYnw.js";import"./vendor-react-gH-7aFTg.js";import"./vendor-router-Du5tOU4S.js";const ve=()=>{const{title:R}=de("/payment-sources","Payment Sources • PayFirst"),[m,n]=a.useState(1),[p,O]=a.useState(10),[j,U]=a.useState("label"),[Q,H]=a.useState(0),[g,Z]=a.useState(""),[b,C]=a.useState({}),[_,$]=a.useState(""),{data:k,isLoading:P,isFetching:q}=se({page:m,page_size:p,ordering:j,refresh:Q,search:b.label}),[K,{isLoading:W}]=te(),[G,{isLoading:J}]=ae(),[V,{isLoading:X}]=le(),A=a.useMemo(()=>{const s=k;if(!s)return{items:[],total:0};if(s.status===!0){const x=s.data;if(Array.isArray(x))return{items:x,total:x.length};const h=x;return Array.isArray(h.results)?{items:h.results,total:h.count??h.results.length}:{items:[],total:0}}if(s.status===!1)return{items:[],total:0};const t=s;return Array.isArray(t.results)?{items:t.results,total:t.count??t.results.length}:{items:[],total:0}},[k]),f=A.items,z=A.total,Y=!!b.label;if(!P&&Y&&f.length===0){const s=`${b.label||""}`;s!==_&&($(s),r.info("No payment sources match your filter. Adjust or clear filters to see results."))}const[ee,c]=a.useState(!1),[y,L]=a.useState(""),[M,T]=a.useState(null),[E,o]=a.useState(null),[F,D]=a.useState("");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:R.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track where payments come from (e.g., Bank A, UPI, etc.)."})]}),e.jsxs(l,{size:"sm",onClick:()=>c(!0),children:[e.jsx(me,{className:"mr-1 h-4 w-4"})," Add Source"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"font-medium",children:"All sources"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-muted-foreground",htmlFor:"ps-page-size",children:"Rows per page"}),e.jsxs("select",{id:"ps-page-size",className:"h-8 rounded-md border bg-background px-2 text-sm",value:p,onChange:s=>{O(Number(s.target.value)),n(1)},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(re,{children:[e.jsxs(ie,{children:[e.jsxs(d,{children:[e.jsx(I,{className:"cursor-pointer select-none",onClick:()=>U(s=>s==="label"?"-label":"label"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Label ",j.includes("label")&&(j.startsWith("-")?e.jsx(ne,{className:"size-4"}):e.jsx(ce,{className:"size-4"}))]})}),e.jsx(I,{className:"w-[1%] whitespace-nowrap text-right pr-3",children:"Actions"})]}),e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(v,{value:g,onChange:s=>Z(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),C({label:g.trim()||void 0}),n(1))},placeholder:"Filter label…",className:"h-8"})}),e.jsx(i,{className:"text-right pr-3",children:e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2",disabled:q,onClick:()=>{C({label:g.trim()||void 0}),n(1)},children:"Apply"})})]})]}),e.jsx(oe,{children:P?Array.from({length:5}).map((s,t)=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(w,{className:"h-4 w-40"})}),e.jsx(i,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(w,{className:"h-8 w-16"}),e.jsx(w,{className:"h-8 w-16"})]})})]},t)):f.length?f.map(s=>e.jsxs(d,{children:[e.jsx(i,{className:"font-medium",children:s.label}),e.jsx(i,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{o(s.id),D(s.label)},children:"Edit"}),e.jsx(l,{size:"sm",variant:"destructive",disabled:X,onClick:async()=>{try{const t=await V(s.id).unwrap();r.success(N(t,"Deleted"))}catch(t){r.error(S(t))}},children:"Delete"})]})})]},s.id)):e.jsx(d,{children:e.jsx(i,{colSpan:2,className:"text-sm text-muted-foreground",children:"No payment sources found"})})})]})}),(()=>{const s=Math.max(1,Math.ceil(z/p));return z>0?e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(t=>Math.max(1,t-1)),disabled:m===1,children:"Prev"}),e.jsxs("span",{className:"text-xs",children:["Page ",m," of ",s]}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(t=>Math.min(s,t+1)),disabled:m>=s,children:"Next"})]}):null})()]}),ee&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>c(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"add-payment-source-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"add-payment-source-title",className:"font-semibold",children:"Add payment source"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>c(!1),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async s=>{if(s.preventDefault(),T(null),!y.trim()){T("Label is required");return}try{const t=await K({label:y.trim()}).unwrap();r.success(N(t,"Payment source added")),L(""),c(!1),H(u=>u+1)}catch(t){r.error(S(t))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(B,{htmlFor:"ps-label",children:"Label"}),e.jsx(v,{id:"ps-label",value:y,onChange:s=>L(s.target.value)})]}),M&&e.jsx("div",{className:"text-sm text-red-600",children:M}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:W,children:"Add"})]})]})]})}),E!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>o(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"edit-payment-source-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"edit-payment-source-title",className:"font-semibold",children:"Edit payment source"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>o(null),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async s=>{s.preventDefault();try{const u=await G({id:E,changes:{label:F.trim()}}).unwrap();r.success(N(u,"Updated")),o(null)}catch(t){r.error(S(t))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(B,{htmlFor:"edit-ps-label",children:"Label"}),e.jsx(v,{id:"edit-ps-label",value:F,onChange:s=>D(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>o(null),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:J,children:"Save"})]})]})]})})]})};export{ve as default};
