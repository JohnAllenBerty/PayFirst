import{u as _,Z as T,_ as A,r as n,l as w,j as e,C as L,c as k,e as U,$ as M,y as F,k as I,d as R,a0 as $,a1 as q,a2 as z,L as N,I as v,B as y}from"./index-BORtUZfV.js";import{S as o}from"./skeleton-Belrx_n-.js";import{u as H}from"./useMeta-CA5u1rdt.js";const K=()=>{const{hasToken:u}=_(),{data:t,isLoading:l,refetch:h}=T(void 0,{skip:!u}),{title:f}=H("/profile","Profile • PayFirst"),[p,{isLoading:g}]=A(),m=n.useMemo(()=>{const s=t;return s&&s.status===!1?w(s):null},[t]),a=t&&typeof t!="string"&&t.status?t.data:null,x=n.useMemo(()=>a?[a.first_name,a.last_name].filter(Boolean).join(" ").trim()||a.user:"Profile",[a]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:f.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your account information."})]}),m&&e.jsxs("div",{className:"rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700 flex items-center justify-between gap-3",children:[e.jsx("span",{children:m}),e.jsx("button",{className:"h-8 rounded-md border px-3 text-sm",onClick:()=>h(),children:"Retry"})]}),l?e.jsxs(L,{className:"max-w-xl",children:[e.jsxs(k,{children:[e.jsx(o,{className:"h-6 w-40"}),e.jsx(o,{className:"h-4 w-64"})]}),e.jsxs(U,{className:"space-y-3",children:[e.jsx(o,{className:"h-9 w-full"}),e.jsx(o,{className:"h-9 w-full"}),e.jsx(o,{className:"h-9 w-full"})]}),e.jsx(M,{className:"justify-end",children:e.jsx(o,{className:"h-9 w-20"})})]}):a?e.jsx(J,{user:a.user,first_name:a.first_name,last_name:a.last_name,date_joined:a.date_joined,last_login:a.last_login,displayName:x,onSave:async s=>{try{const i=await p(s).unwrap();F.success(I(i,"Profile updated"))}catch(i){throw F.error(w(i)),i}},saving:g}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No profile data"})]})};function J({user:u,first_name:t,last_name:l,date_joined:h,last_login:f,displayName:p,onSave:g,saving:m}){const[a,x]=n.useState(!1),[s,i]=n.useState(u),[c,b]=n.useState(t),[d,C]=n.useState(l),[S,j]=n.useState(null),E=n.useMemo(()=>[c||t,d||l].filter(Boolean).map(B=>(B||"").trim()[0]).filter(Boolean).join("").slice(0,2)||(s||"U")[0]?.toUpperCase()||"U",[c,d,s,t,l]),D=(s!==u||c!==t||d!==l)&&!!s.trim();return e.jsxs(L,{className:"max-w-xl",children:[e.jsxs(k,{children:[e.jsxs(R,{className:"flex items-center gap-3",children:[e.jsx($,{className:"h-8 w-8 rounded-lg",children:e.jsx(q,{className:"rounded-lg",children:E})}),p]}),e.jsx(z,{children:"Update your account information."})]}),e.jsxs(U,{className:"grid gap-4",children:[e.jsxs("div",{className:"text-xs text-muted-foreground grid gap-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Joined:"})," ",new Date(h).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Last login:"})," ",new Date(f).toLocaleString()]})]}),a?e.jsxs("form",{className:"grid gap-3",onSubmit:async r=>{if(r.preventDefault(),j(null),!s.trim()){j("User is required");return}try{await g({user:s.trim(),first_name:c.trim(),last_name:d.trim()}),x(!1)}catch(P){j(w(P))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"u",children:"User"}),e.jsx(v,{id:"u",value:s,onChange:r=>i(r.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"f",children:"First name"}),e.jsx(v,{id:"f",value:c,onChange:r=>b(r.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"l",children:"Last name"}),e.jsx(v,{id:"l",value:d,onChange:r=>C(r.target.value)})]}),S&&e.jsx("div",{className:"text-sm text-red-600",children:S}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>{i(u),b(t),C(l),j(null),x(!1)},children:"Cancel"}),e.jsx(y,{type:"submit",disabled:m||!D,children:m?"Saving…":"Save"})]})]}):e.jsxs("div",{className:"grid gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"User"}),e.jsx("span",{children:s})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"First name"}),e.jsx("span",{children:c||"—"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last name"}),e.jsx("span",{children:d||"—"})]})]})]}),e.jsx(M,{className:"justify-end",children:!a&&e.jsx(y,{size:"sm",onClick:()=>x(!0),children:"Edit"})})]})}export{K as default};
