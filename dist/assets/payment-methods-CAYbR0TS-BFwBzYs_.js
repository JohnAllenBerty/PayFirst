import{v as a,t as ce,A as de,O as oe,J as me,P as r,x as e,Z as i,j as C,I as S,R as A,z as K}from"./index-DnKD0KXe.js";import{n as he,m as xe,p as x,f as p,x as ue,w as je,b as l,i as pe}from"./table-DQfnjL0Y-DmfacWdK.js";import{o as u}from"./skeleton-mX7TdaWE-Cq_BwO7K.js";import{a as fe}from"./useMeta-Do0ZXGYI-DbPzVoKD.js";import{t as ge}from"./plus-CiLcYsv4-DazmbEJE.js";const ke=()=>{const{title:T}=fe("/payment-methods","Payment Methods • PayFirst"),[j,d]=a.useState(1),[f,W]=a.useState(10),[g,Z]=a.useState("label"),[B,G]=a.useState(0),[b,H]=a.useState(""),[N,z]=a.useState({}),[Q,V]=a.useState(""),{data:_,isLoading:D,isFetching:X}=ce({page:j,page_size:f,ordering:g,refresh:B,search:N.label}),[ee,{isLoading:se}]=de(),[te,{isLoading:ae}]=oe(),[le,{isLoading:ie}]=me(),P=a.useMemo(()=>{const s=_;if(!s)return{items:[],total:0};if(s.status===!0){const n=s.data;if(Array.isArray(n))return{items:n,total:n.length};const c=n;return Array.isArray(c.results)?{items:c.results,total:c.count??c.results.length}:{items:[],total:0}}if(s.status===!1)return{items:[],total:0};const t=s;return Array.isArray(t.results)?{items:t.results,total:t.count??t.results.length}:{items:[],total:0}},[_]),o=P.items,$=P.total,ne=!!N.label;if(!D&&ne&&o.length===0){const s=`${N.label||""}`;s!==Q&&(V(s),r.info("No payment methods match your filter. Adjust or clear filters to see results."))}const[re,m]=a.useState(!1),[y,L]=a.useState(""),[v,M]=a.useState(!1),[F,E]=a.useState(!1),[O,w]=a.useState(null),[R,h]=a.useState(null),[U,I]=a.useState(""),[k,Y]=a.useState(!1),[q,J]=a.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:T.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage methods you use for transactions and repayments."})]}),e.jsxs(i,{size:"sm",onClick:()=>m(!0),children:[e.jsx(ge,{className:"mr-1 h-4 w-4"})," Add Method"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"font-medium",children:"All methods"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-muted-foreground",htmlFor:"pm-page-size",children:"Rows per page"}),e.jsxs("select",{id:"pm-page-size",className:"h-8 rounded-md border bg-background px-2 text-sm",value:f,onChange:s=>{W(Number(s.target.value)),d(1)},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]}),e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(he,{children:[e.jsxs(xe,{children:[e.jsxs(x,{children:[e.jsx(p,{className:"cursor-pointer select-none",onClick:()=>Z(s=>s==="label"?"-label":"label"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Label ",g.includes("label")&&(g.startsWith("-")?e.jsx(ue,{className:"size-4"}):e.jsx(je,{className:"size-4"}))]})}),e.jsx(p,{children:"Default"}),e.jsx(p,{children:"Common"}),e.jsx(p,{className:"w-[1%] whitespace-nowrap text-right pr-3",children:"Actions"})]}),e.jsxs(x,{children:[e.jsx(l,{children:e.jsx(C,{value:b,onChange:s=>H(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),z({label:b.trim()||void 0}),d(1))},placeholder:"Filter label…",className:"h-8"})}),e.jsx(l,{}),e.jsx(l,{}),e.jsx(l,{className:"text-right pr-3",children:e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2",disabled:X,onClick:()=>{z({label:b.trim()||void 0}),d(1)},children:"Apply"})})]})]}),e.jsx(pe,{children:D?Array.from({length:5}).map((s,t)=>e.jsxs(x,{children:[e.jsx(l,{children:e.jsx(u,{className:"h-4 w-40"})}),e.jsx(l,{children:e.jsx(u,{className:"h-4 w-16"})}),e.jsx(l,{children:e.jsx(u,{className:"h-4 w-16"})}),e.jsx(l,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(u,{className:"h-8 w-16"}),e.jsx(u,{className:"h-8 w-16"})]})})]},t)):o.length?o.map(s=>e.jsxs(x,{children:[e.jsx(l,{className:"font-medium",children:s.label}),e.jsx(l,{children:s.is_default?"Yes":"No"}),e.jsx(l,{children:s.is_common?"Yes":"No"}),e.jsx(l,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>{h(s.id),I(s.label),Y(!!s.is_default),J(!!s.is_common)},children:"Edit"}),e.jsx(i,{size:"sm",variant:"destructive",disabled:ie,onClick:async()=>{try{const t=await le(s.id).unwrap();r.success(S(t,"Deleted"))}catch(t){r.error(A(t))}},children:"Delete"})]})})]},s.id)):e.jsx(x,{children:e.jsx(l,{colSpan:4,className:"text-sm text-muted-foreground",children:"No payment methods found"})})})]})}),(()=>{const s=Math.max(1,Math.ceil($/f));return $>0?e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>d(t=>Math.max(1,t-1)),disabled:j===1,children:"Prev"}),e.jsxs("span",{className:"text-xs",children:["Page ",j," of ",s]}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>d(t=>Math.min(s,t+1)),disabled:j>=s,children:"Next"})]}):null})()]}),re&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>m(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"add-payment-method-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"add-payment-method-title",className:"font-semibold",children:"Add payment method"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>m(!1),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async s=>{if(s.preventDefault(),w(null),!y.trim()){w("Label is required");return}if(v&&o.some(t=>t.is_default)){w("There is already a default payment method. Unset it before creating a new default.");return}try{const t=await ee({label:y.trim(),is_default:v,is_common:F}).unwrap();r.success(S(t,"Payment method added")),L(""),M(!1),E(!1),m(!1),G(n=>n+1)}catch(t){r.error(A(t))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(K,{htmlFor:"pm-label",children:"Label"}),e.jsx(C,{id:"pm-label",value:y,onChange:s=>L(s.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:s=>M(s.target.checked)})," Default"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:s=>E(s.target.checked)})," Common"]})]}),O&&e.jsx("div",{className:"text-sm text-red-600",children:O}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(i,{type:"submit",disabled:se,children:"Add"})]})]})]})}),R!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>h(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"edit-payment-method-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"edit-payment-method-title",className:"font-semibold",children:"Edit payment method"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>h(null),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async s=>{s.preventDefault();try{const t=R;if(k&&o.some(c=>c.is_default&&c.id!==t)){r.error("Only one default method is allowed. Unset the other default first.");return}const n=await te({id:t,changes:{label:U.trim(),is_default:k,is_common:q}}).unwrap();r.success(S(n,"Updated")),h(null)}catch(t){r.error(A(t))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(K,{htmlFor:"edit-pm-label",children:"Label"}),e.jsx(C,{id:"edit-pm-label",value:U,onChange:s=>I(s.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:s=>Y(s.target.checked)})," Default"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:q,onChange:s=>J(s.target.checked)})," Common"]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>h(null),children:"Cancel"}),e.jsx(i,{type:"submit",disabled:ae,children:"Save"})]})]})]})})]})};export{ke as default};
