import{m as lt,r as n,j as e,n as ct,P as ot,o as fe,p as dt,q as Ve,s as Be,t as ut,v as mt,w as pt,e as xt,x as ht,z as ft,A as gt,D as jt,y as z,B as l,I as te,L as M,i as se,k as ae,R as bt,l as vt}from"./index-DpPxujIM.js";import{S as $}from"./skeleton-CC-v-xk6.js";import{T as Nt,b as Ct,c as Q,d as he,A as yt,a as kt,e as I,f as wt}from"./table-Uq6t8XZy.js";import{u as St}from"./useMeta-D01q9Dg8.js";import{F as Pt,L as Et,C as zt}from"./layout-list-C7uvBGbF.js";import{S as Ue}from"./search-D-PoXbp7.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Rt=lt("check",It);function _t(i){const d=n.useRef({value:i,previous:i});return n.useMemo(()=>(d.current.value!==i&&(d.current.previous=d.current.value,d.current.value=i),d.current.previous),[i])}var ne="Checkbox",[At,Vt]=ct(ne),[Mt,ge]=At(ne);function Lt(i){const{__scopeCheckbox:d,checked:p,children:u,defaultChecked:x,disabled:o,form:h,name:v,onCheckedChange:m,required:y,value:j="on",internal_do_not_use_render:f}=i,[N,_]=dt({prop:p,defaultProp:x??!1,onChange:m,caller:ne}),[C,k]=n.useState(null),[A,c]=n.useState(null),g=n.useRef(!1),B=C?!!h||!!C.closest("form"):!0,U={checked:N,disabled:o,setChecked:_,control:C,setControl:k,name:v,form:h,value:j,hasConsumerStoppedPropagationRef:g,required:y,defaultChecked:L(x)?!1:x,isFormControl:B,bubbleInput:A,setBubbleInput:c};return e.jsx(Mt,{scope:d,...U,children:Dt(f)?f(U):u})}var qe="CheckboxTrigger",He=n.forwardRef(({__scopeCheckbox:i,onKeyDown:d,onClick:p,...u},x)=>{const{control:o,value:h,disabled:v,checked:m,required:y,setControl:j,setChecked:f,hasConsumerStoppedPropagationRef:N,isFormControl:_,bubbleInput:C}=ge(qe,i),k=Ve(x,j),A=n.useRef(m);return n.useEffect(()=>{const c=o?.form;if(c){const g=()=>f(A.current);return c.addEventListener("reset",g),()=>c.removeEventListener("reset",g)}},[o,f]),e.jsx(fe.button,{type:"button",role:"checkbox","aria-checked":L(m)?"mixed":m,"aria-required":y,"data-state":Ze(m),"data-disabled":v?"":void 0,disabled:v,value:h,...u,ref:k,onKeyDown:Be(d,c=>{c.key==="Enter"&&c.preventDefault()}),onClick:Be(p,c=>{f(g=>L(g)?!0:!g),C&&_&&(N.current=c.isPropagationStopped(),N.current||c.stopPropagation())})})});He.displayName=qe;var Ke=n.forwardRef((i,d)=>{const{__scopeCheckbox:p,name:u,checked:x,defaultChecked:o,required:h,disabled:v,value:m,onCheckedChange:y,form:j,...f}=i;return e.jsx(Lt,{__scopeCheckbox:p,checked:x,defaultChecked:o,disabled:v,required:h,onCheckedChange:y,name:u,form:j,value:m,internal_do_not_use_render:({isFormControl:N})=>e.jsxs(e.Fragment,{children:[e.jsx(He,{...f,ref:d,__scopeCheckbox:p}),N&&e.jsx(Xe,{__scopeCheckbox:p})]})})});Ke.displayName=ne;var $e="CheckboxIndicator",Qe=n.forwardRef((i,d)=>{const{__scopeCheckbox:p,forceMount:u,...x}=i,o=ge($e,p);return e.jsx(ot,{present:u||L(o.checked)||o.checked===!0,children:e.jsx(fe.span,{"data-state":Ze(o.checked),"data-disabled":o.disabled?"":void 0,...x,ref:d,style:{pointerEvents:"none",...i.style}})})});Qe.displayName=$e;var Je="CheckboxBubbleInput",Xe=n.forwardRef(({__scopeCheckbox:i,...d},p)=>{const{control:u,hasConsumerStoppedPropagationRef:x,checked:o,defaultChecked:h,required:v,disabled:m,name:y,value:j,form:f,bubbleInput:N,setBubbleInput:_}=ge(Je,i),C=Ve(p,_),k=_t(o),A=ut(u);n.useEffect(()=>{const g=N;if(!g)return;const B=window.HTMLInputElement.prototype,J=Object.getOwnPropertyDescriptor(B,"checked").set,re=!x.current;if(k!==o&&J){const ie=new Event("click",{bubbles:re});g.indeterminate=L(o),J.call(g,L(o)?!1:o),g.dispatchEvent(ie)}},[N,k,o,x]);const c=n.useRef(L(o)?!1:o);return e.jsx(fe.input,{type:"checkbox","aria-hidden":!0,defaultChecked:h??c.current,required:v,disabled:m,name:y,value:j,form:f,...d,tabIndex:-1,ref:C,style:{...d.style,...A,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Xe.displayName=Je;function Dt(i){return typeof i=="function"}function L(i){return i==="indeterminate"}function Ze(i){return L(i)?"indeterminate":i?"checked":"unchecked"}function Oe({className:i,...d}){return e.jsx(Ke,{"data-slot":"checkbox",className:mt("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",i),...d,children:e.jsx(Qe,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(Rt,{className:"size-3.5"})})})}const qt=()=>{const[i,d]=n.useState("name"),[p,u]=n.useState(1),[x,o]=n.useState(10),[h,v]=n.useState(!1),[m,y]=n.useState(""),[j,f]=n.useState({name:""}),[N,_]=n.useState(0),{data:C,isLoading:k,isFetching:A}=pt({page:h?1:p,page_size:h?1e3:x,ordering:i,search:j.name||void 0,refresh:N}),{data:c,isLoading:g,refetch:B}=xt(),[U,{isLoading:J}]=ht(),[re,{isLoading:ie}]=ft(),[We,{isLoading:X}]=gt(),[le,je]=n.useState(""),[be,ve]=n.useState([]),[Ne,Z]=n.useState(null),[Ye,O]=n.useState(!1),[Ce,ye]=n.useState(null),[ke,V]=n.useState(null),[q,D]=n.useState(null),[ce,W]=n.useState(""),[we,Y]=n.useState([]),[Se,T]=n.useState(null),[H,Pe]=n.useState(null),[Ee,oe]=n.useState(null),[et,K]=n.useState(!1),[ze,Ie]=n.useState(null),[Re,tt]=n.useState("google"),[st,{isLoading:_e}]=jt(),b=n.useMemo(()=>c&&typeof c!="string"&&c?.status?c?.data:[],[c]),Ae=n.useMemo(()=>{const t=C;if(!t)return{items:[],total:0};if(t.status===!0){const r=t.data;return Array.isArray(r)?{items:r,total:r.length}:{items:r.results??[],total:r.count??(r.results?r.results.length:0)}}if(t.status===!1)return{items:[],total:0};const s=t;return Array.isArray(s.results)?{items:s.results,total:s.count}:{items:[],total:0}},[C]),R=Ae.items,ee=Ae.total,Me=typeof c=="string"?c:c&&typeof c!="string"&&c.status===!1?String(c.error??"Server error"):null,Le=(()=>{const t=C;return t&&t.status===!1?String(t.error??"Server error"):null})(),at=(t,s)=>{ve(a=>s?Array.from(new Set([...a,t])):a.filter(r=>r!==t))},nt=async t=>{if(t.preventDefault(),Z(null),!le.trim())return Z("Name is required"),!1;try{const s=new FormData;s.append("name",le.trim()),be.forEach(r=>s.append("groups",String(r))),Ce&&s.append("picture",Ce);const a=await U(s).unwrap();return je(""),ve([]),ye(null),z.success(se(a,"Contact created")),!0}catch(s){const a=ae(s);return Z(a),z.error(a),!1}},De=n.useMemo(()=>Array.isArray(b)&&b.some(t=>Array.isArray(t.subgroups)&&t.subgroups.length>0),[b]),Fe=n.useMemo(()=>{if(!b)return[];if(De){const a=r=>({id:r.id,name:r.name,parent_group:r.parent_group??null,children:Array.isArray(r.subgroups)?r.subgroups.map(a):[]});return b.map(a)}const t=new Map,s=[];return b.forEach(a=>t.set(a.id,{id:a.id,name:a.name,parent_group:a.parent_group??null,children:[]})),b.forEach(a=>{const r=t.get(a.id);a.parent_group&&t.has(a.parent_group)?t.get(a.parent_group).children.push(r):s.push(r)}),s},[b,De]),rt=n.useMemo(()=>{const t=new Map;return R.forEach(s=>{(s.groups||[]).forEach(r=>{const w=t.get(r)||[];w.push(s),t.set(r,w)})}),t},[R]),de=n.useMemo(()=>R.filter(t=>!t.groups||t.groups.length===0),[R]),Te=n.useRef("");n.useEffect(()=>{if(!!!(j.name&&j.name.trim()))return;const s=ee,a=`${j.name}`;!k&&s===0&&Te.current!==a&&(Te.current=a,z.info("No contacts match your filter. Adjust or clear filters to see results."))},[j.name,ee,k]);const Ge=({node:t,depth:s,contactsByGroup:a,onView:r,onEdit:w,onDelete:S})=>{const[G,P]=bt.useState(!0),F=t.children||[],me=a.get(t.id)||[],pe=F.length>0,xe=me.length>0;return e.jsxs("li",{className:"text-sm",style:{paddingLeft:s*12},children:[e.jsx("div",{className:"flex items-center justify-between py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[pe||xe?e.jsx("button",{type:"button","aria-label":G?"Collapse":"Expand",className:"text-muted-foreground hover:text-foreground transition-colors",onClick:()=>P(E=>!E),children:G?e.jsx(zt,{className:"size-4"}):e.jsx(vt,{className:"size-4"})}):e.jsx("span",{className:"inline-block w-4"}),e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx("span",{children:t.name}),(xe||pe)&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",me.length,pe?`, ${F.length} sub`:"",")"]})]})]})}),G&&e.jsxs("div",{className:"ml-3",children:[xe&&e.jsx("ul",{className:"space-y-1",children:me.map(E=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:E.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>r(E.id),children:"View"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>w(E),children:"Edit"}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>S(E.id),disabled:X,children:"Delete"})]})]},E.id))}),F.length>0&&e.jsx("ul",{className:"border-l pl-3 mt-1",children:F.map(E=>e.jsx(Ge,{node:E,depth:s+1,contactsByGroup:a,onView:r,onEdit:w,onDelete:S},E.id))})]})]})},{title:it}=St("/contact","Contacts • PayFirst"),ue=t=>t.picture;return n.useEffect(()=>{let t=null;if(q===null)oe(null),Pe(null);else if(H)t=URL.createObjectURL(H),oe(t);else{const s=R.find(r=>r.id===q),a=s?ue(s)??null:null;oe(a)}return()=>{t&&URL.revokeObjectURL(t)}},[q,H,R]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:it.replace(/\s*•\s*PayFirst$/,"")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage your contacts and assign them to groups."})]}),Me&&e.jsxs("div",{className:"max-w-xl rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700 flex items-center justify-between gap-3",children:[e.jsx("span",{children:Me}),e.jsx(l,{type:"button",size:"sm",variant:"outline",onClick:()=>B(),children:"Retry"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(l,{size:"sm",variant:"outline",onClick:()=>K(!0),children:"Import CSV"})}),e.jsx(l,{size:"sm",onClick:()=>{O(!0),Z(null)},children:"New Contact"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"font-medium",children:"All contacts"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[!h&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-muted-foreground",htmlFor:"contact-page-size",children:"Rows per page"}),e.jsxs("select",{id:"contact-page-size",className:"h-8 rounded-md border bg-background px-2 text-sm",value:x,onChange:t=>{o(Number(t.target.value)),u(1)},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]}),e.jsxs(l,{variant:h?"default":"outline",size:"sm",className:"gap-1",onClick:()=>{v(!0),u(1)},children:[e.jsx(Pt,{className:"size-4"})," Tree"]}),e.jsxs(l,{variant:h?"outline":"default",size:"sm",className:"gap-1",onClick:()=>v(!1),children:[e.jsx(Et,{className:"size-4"})," List"]})]})]}),Le&&e.jsxs("div",{className:"rounded-md border border-red-200 bg-red-50 p-3 text-sm text-red-700 flex items-center justify-between gap-3",children:[e.jsx("span",{children:Le}),e.jsx(l,{type:"button",size:"sm",variant:"outline",onClick:()=>_(t=>t+1),children:"Retry"})]}),h?e.jsxs("div",{className:"rounded-md border divide-y",children:[e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(te,{value:m,onChange:t=>y(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),f({name:m.trim().toLowerCase()}),u(1))},placeholder:"Filter name…",className:"pl-8 h-8 w-64"}),e.jsx(Ue,{className:"absolute left-2 top-2 size-4 text-muted-foreground"})]}),e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2",disabled:A,onClick:()=>{f({name:m.trim().toLowerCase()}),u(1)},children:"Apply"})]}),e.jsxs("ul",{className:"p-2",children:[Fe.map(t=>e.jsx(Ge,{node:t,depth:0,contactsByGroup:rt,onView:s=>V(s),onEdit:s=>{D(s.id),W(s.name),Y(s.groups||[])},onDelete:s=>T(s)},t.id)),de.length>0&&e.jsxs("li",{className:"pt-2",children:[e.jsx("div",{className:"font-medium text-sm mb-1",children:"Ungrouped"}),e.jsx("ul",{className:"ml-3 space-y-1",children:de.map(t=>e.jsxs("li",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>V(t.id),children:"View"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{D(t.id),W(t.name),Y(t.groups||[])},children:"Edit"}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>T(t.id),disabled:X,children:"Delete"})]})]},t.id))})]}),Fe.length===0&&de.length===0&&e.jsx("li",{className:"text-sm text-muted-foreground",children:"No contacts found"})]})]}):e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(Nt,{children:[e.jsxs(Ct,{children:[e.jsxs(Q,{children:[e.jsx(he,{className:"cursor-pointer select-none",onClick:()=>d(t=>t==="name"?"-name":"name"),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:["Name ",i.includes("name")&&(i.startsWith("-")?e.jsx(yt,{className:"size-4"}):e.jsx(kt,{className:"size-4"}))]})}),e.jsx(he,{children:"Groups"}),e.jsx(he,{className:"w-[1%] whitespace-nowrap text-right pr-3",children:"Actions"})]}),e.jsxs(Q,{children:[e.jsx(I,{children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{value:m,onChange:t=>{y(t.target.value)},onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),f({name:m.trim().toLowerCase()}),u(1))},placeholder:"Filter name…",className:"pl-8 h-8"}),e.jsx(Ue,{className:"absolute left-2 top-2 size-4 text-muted-foreground"})]})}),e.jsx(I,{}),e.jsx(I,{className:"text-right pr-3",children:e.jsx(l,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2",disabled:A,onClick:()=>{f({name:m.trim().toLowerCase()}),u(1)},children:"Apply"})})]})]}),e.jsx(wt,{children:k?Array.from({length:5}).map((t,s)=>e.jsxs(Q,{children:[e.jsx(I,{children:e.jsx($,{className:"h-4 w-40"})}),e.jsx(I,{children:e.jsx($,{className:"h-4 w-24"})}),e.jsx(I,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx($,{className:"h-8 w-16"}),e.jsx($,{className:"h-8 w-16"}),e.jsx($,{className:"h-8 w-16"})]})})]},s)):R.length?R.map(t=>e.jsxs(Q,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const s=ue(t);return s?e.jsx("img",{src:s,alt:t.name,className:"h-8 w-8 rounded-full object-cover border",loading:"lazy"}):e.jsx("div",{className:"h-8 w-8 rounded-full bg-muted flex items-center justify-center text-xs font-medium border",children:t.name?.charAt(0)?.toUpperCase()||"?"})})(),e.jsx("div",{className:"font-medium",children:t.name})]})}),e.jsx(I,{className:"text-muted-foreground",children:(()=>{const s=new Map;b.forEach(S=>s.set(S.id,S));const a=S=>{const G=[];let P=s.get(S);const F=new Set;for(;P&&!F.has(P.id)&&(F.add(P.id),G.unshift(P.name),P.parent_group&&s.has(P.parent_group));)P=s.get(P.parent_group);return G.join(" > ")},r=t.groups||[];if(!r.length)return"—";const w=r.map(a).filter(Boolean);return w.length?w.join(", "):r.map(S=>s.get(S)?.name||String(S)).join(", ")})()}),e.jsx(I,{className:"text-right pr-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>V(t.id),children:"View"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{D(t.id),W(t.name),Y(t.groups||[])},children:"Edit"}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>T(t.id),disabled:X,children:"Delete"})]})})]},t.id)):e.jsx(Q,{children:e.jsx(I,{colSpan:3,className:"text-sm text-muted-foreground",children:"No contacts found"})})})]})}),(()=>{const t=Math.max(1,Math.ceil(ee/x));return!h&&ee>0?e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>u(s=>Math.max(1,s-1)),disabled:p===1,children:"Prev"}),e.jsxs("span",{className:"text-xs",children:["Page ",p," of ",t]}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>u(s=>Math.min(t,s+1)),disabled:p>=t,children:"Next"})]}):null})()]}),Ye&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>O(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"new-contact-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"new-contact-title",className:"font-semibold",children:"New contact"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>O(!1),children:"Close"})]}),e.jsxs("form",{onSubmit:async t=>{await nt(t)&&O(!1)},className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"name",children:"Name"}),e.jsx(te,{id:"name",value:le,onChange:t=>je(t.target.value),placeholder:"Jane Doe"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"picture",children:"Picture"}),e.jsx("input",{id:"picture",type:"file",accept:"image/*",onChange:t=>ye(t.target.files?.[0]||null),className:"h-9 rounded-md border bg-background px-2 text-sm"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Optional. JPG/PNG recommended."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{children:"Groups"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:g?e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading groups…"}):b.length?b.map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Oe,{checked:be.includes(t.id),onCheckedChange:s=>at(t.id,!!s)}),e.jsx("span",{children:t.name})]},t.id)):e.jsx("span",{className:"text-sm text-muted-foreground",children:"No groups yet"})})]}),Ne&&e.jsx("div",{className:"text-sm text-red-600",children:Ne}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>O(!1),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:J,children:"Create"})]})]})]})}),ke!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>V(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"view-contact-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"view-contact-title",className:"font-semibold",children:"Contact details"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>V(null),children:"Close"})]}),(()=>{const t=R.find(a=>a.id===ke);if(!t)return e.jsx("div",{className:"text-sm",children:"Not found"});const s=(t.groups||[]).map(a=>b.find(r=>r.id===a)?.name||String(a));return e.jsxs("div",{className:"text-sm space-y-2",children:[(()=>{const a=ue(t);return e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Picture:"}),e.jsx("div",{className:"pt-1",children:a?e.jsx("img",{src:a,alt:t.name,className:"h-20 w-20 rounded-md object-cover border"}):e.jsx("div",{className:"h-20 w-20 rounded-md bg-muted flex items-center justify-center text-base font-medium border",children:t.name?.charAt(0)?.toUpperCase()||"?"})})]})})(),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Name:"})," ",t.name]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Groups:"})," ",s.length?s.join(", "):"—"]})]})})()]})}),q!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>D(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"edit-contact-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"edit-contact-title",className:"font-semibold",children:"Edit contact"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>D(null),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async t=>{t.preventDefault();try{const s=q,a=new FormData;a.append("name",ce.trim()),we.forEach(w=>a.append("groups",String(w))),H&&a.append("picture",H);const r=await re({id:s,changes:a}).unwrap();z.success(se(r,"Contact updated")),D(null)}catch(s){z.error(ae(s))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"edit-name",children:"Name"}),e.jsx(te,{id:"edit-name",value:ce,onChange:t=>W(t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"edit-picture",children:"Picture"}),e.jsx("input",{id:"edit-picture",type:"file",accept:"image/*",onChange:t=>{const s=t.target.files?.[0]||null;Pe(s)},className:"h-9 rounded-md border bg-background px-2 text-sm"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Optional. Upload to replace existing picture."}),Ee&&e.jsx("div",{className:"pt-2",children:e.jsx("img",{src:Ee,alt:ce||"Contact picture",className:"h-20 w-20 rounded-md object-cover border"})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{children:"Groups"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:b.map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Oe,{checked:we.includes(t.id),onCheckedChange:s=>Y(a=>s?Array.from(new Set([...a,t.id])):a.filter(r=>r!==t.id))}),e.jsx("span",{children:t.name})]},t.id))})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>D(null),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:ie,children:"Save"})]})]})]})}),Se!==null&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>T(null),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"delete-contact-title",className:"bg-background rounded-md p-4 w-[420px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{id:"delete-contact-title",className:"font-semibold mb-2",children:"Delete contact"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>T(null),children:"Cancel"}),e.jsx(l,{variant:"destructive",disabled:X,onClick:async()=>{try{const t=await We(Se).unwrap();z.success(se(t,"Contact deleted"))}catch(t){z.error(ae(t))}finally{T(null)}},children:"Delete"})]})]})}),et&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",onClick:()=>K(!1),children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"import-contacts-title",className:"bg-background rounded-md p-4 w-[520px] max-w-[95vw]",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{id:"import-contacts-title",className:"font-semibold",children:"Import contacts from CSV"}),e.jsx("button",{"aria-label":"Close dialog",className:"text-sm text-muted-foreground",onClick:()=>K(!1),children:"Close"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:async t=>{if(t.preventDefault(),!ze){z.error("Please choose a CSV file");return}try{const s=await st({file:ze,_type:Re}).unwrap();z.success(se(s,"Import started")),K(!1),Ie(null),_(a=>a+1)}catch(s){z.error(ae(s))}},children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"import-file",children:"CSV file"}),e.jsx("input",{id:"import-file",type:"file",accept:".csv,text/csv",onChange:t=>Ie(t.target.files?.[0]||null),className:"h-9 rounded-md border bg-background px-2 text-sm"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Upload a CSV exported from Google Contacts."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(M,{htmlFor:"import-type",children:"Type"}),e.jsx("select",{id:"import-type",className:"h-9 rounded-md border bg-background px-2 text-sm",value:Re,onChange:t=>tt(t.target.value),children:e.jsx("option",{value:"google",children:"Google"})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>K(!1),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:_e,children:_e?"Importing…":"Import"})]})]})]})})]})};export{qt as default};
